<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>新版 React 知识学习总结 | Arvin's Blogs</title><meta name="keywords" content="blog"><meta name="author" content="Arvin Huang"><meta name="copyright" content="Arvin Huang"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="React一、前提基础1、JavaScript基础（ECMAScript）ES6文档：http:&#x2F;&#x2F;es6.ruanyifeng.com&#x2F; 注意：这里我节选一些常用新特性的简述，详情或不足之处请见文档 1、let、const​    let 定义的变量不会被变量提升，const 定义的常量不能被修改，let 和 const 都是块级作用域 2、import、export​    import导入模">
<meta property="og:type" content="article">
<meta property="og:title" content="新版 React 知识学习总结">
<meta property="og:url" content="https://hello-hc.github.io/2019/11/08/new-react-file/new-react-file/">
<meta property="og:site_name" content="Arvin&#39;s Blogs">
<meta property="og:description" content="React一、前提基础1、JavaScript基础（ECMAScript）ES6文档：http:&#x2F;&#x2F;es6.ruanyifeng.com&#x2F; 注意：这里我节选一些常用新特性的简述，详情或不足之处请见文档 1、let、const​    let 定义的变量不会被变量提升，const 定义的常量不能被修改，let 和 const 都是块级作用域 2、import、export​    import导入模">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hello-hc.github.io/images/aixin.jpg">
<meta property="article:published_time" content="2019-11-08T10:14:12.000Z">
<meta property="article:modified_time" content="2019-12-04T11:27:52.000Z">
<meta property="article:author" content="Arvin Huang">
<meta property="article:tag" content="blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hello-hc.github.io/images/aixin.jpg"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://hello-hc.github.io/2019/11/08/new-react-file/new-react-file/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '新版 React 知识学习总结',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2019-12-04 19:27:52'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/aixin.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Arvin's Blogs</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">新版 React 知识学习总结</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2019-11-08T10:14:12.000Z" title="发表于 2019-11-08 18:14:12">2019-11-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2019-12-04T11:27:52.000Z" title="更新于 2019-12-04 19:27:52">2019-12-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="新版 React 知识学习总结"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="React"><a href="#React" class="headerlink" title="React"></a>React</h1><h2 id="一、前提基础"><a href="#一、前提基础" class="headerlink" title="一、前提基础"></a>一、前提基础</h2><h3 id="1、JavaScript基础（ECMAScript）"><a href="#1、JavaScript基础（ECMAScript）" class="headerlink" title="1、JavaScript基础（ECMAScript）"></a>1、JavaScript基础（ECMAScript）</h3><p>ES6文档：<a target="_blank" rel="noopener" href="http://es6.ruanyifeng.com/">http://es6.ruanyifeng.com/</a></p>
<p>注意：这里我节选一些常用新特性的简述，详情或不足之处请见文档</p>
<h4 id="1、let、const"><a href="#1、let、const" class="headerlink" title="1、let、const"></a>1、let、const</h4><p>​    <strong>let 定义的变量不会被变量提升，const 定义的常量不能被修改，let 和 const 都是块级作用域</strong></p>
<h4 id="2、import、export"><a href="#2、import、export" class="headerlink" title="2、import、export"></a>2、import、export</h4><p>​    <strong>import导入模块、export导出模块</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入所有</span></span><br><span class="line"><span class="keyword">import</span> demo <span class="keyword">from</span> <span class="string">&#x27;./src/demo&#x27;</span></span><br><span class="line"><span class="comment">//导入部分（按需导入）</span></span><br><span class="line"><span class="keyword">import</span> &#123; demo &#125; <span class="keyword">from</span> <span class="string">&#x27;./src/demo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//导出所有</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br><span class="line"></span><br><span class="line"><span class="comment">//部分导出</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、class、extends、super"><a href="#3、class、extends、super" class="headerlink" title="3、class、extends、super"></a>3、class、extends、super</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面代码首先用class定义了一个“类”，可以看到里面有一个constructor方法，这就是构造方法，而this关键字则代表实例对象。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简单地说，constructor内定义的方法和属性是实例对象自己的，而constructor外定义的方法和属性则是所有实例对象可以共享的。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Class之间可以通过extends关键字实现继承，这比ES5的通过修改原型链实现继承，要清晰和方便很多。上面定义了一个Cat类，该类通过extends关键字，继承了Animal类的所有属性和方法。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// super关键字，它指代父类的实例（即父类的this对象）。子类必须在constructor方法中调用super方法，否则新建实例时会报错。这是因为子类没有自己的this对象，而是继承父类的this对象，然后对其进行加工。如果不调用super方法，子类就得不到this对象。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6的继承机制，实质是先创造父类的实例对象this（所以必须先调用super方法），然后再用子类的构造函数修改this。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.type = <span class="string">&#x27;animal&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="function"><span class="title">says</span>(<span class="params">say</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.type + <span class="string">&#x27; says &#x27;</span> + say);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> animal = <span class="keyword">new</span> Animal();</span><br><span class="line">animal.says(<span class="string">&#x27;hello&#x27;</span>); <span class="comment">//animal says hello</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">		<span class="built_in">super</span>();</span><br><span class="line">		<span class="built_in">this</span>.type = <span class="string">&#x27;cat&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> cat = <span class="keyword">new</span> Cat();</span><br><span class="line">cat.says(<span class="string">&#x27;hello&#x27;</span>); <span class="comment">//cat says hello</span></span><br></pre></td></tr></table></figure>

<h4 id="4、箭头函数"><a href="#4、箭头函数" class="headerlink" title="4、箭头函数"></a>4、箭头函数</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//普通函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="comment">//箭头函数</span></span><br><span class="line">() =&gt; &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数的快捷写法。不需要 function 关键字来创建函数，省略 return 关键字，继承当前上下文的 this 关键字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">var</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">var</span> newArr1 = arr1.map(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x + <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> arr2 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> newArr2 = arr2.map(<span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">	x + <span class="number">1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5、模板字符串"><a href="#5、模板字符串" class="headerlink" title="5、模板字符串"></a>5、模板字符串</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字符串拼接</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">&quot;world&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="string">&quot;hello&quot;</span> + a;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用模板字符串</span></span><br><span class="line"><span class="keyword">var</span> c = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> d = <span class="string">`<span class="subst">$&#123;c&#125;</span> world`</span>;</span><br><span class="line"><span class="built_in">console</span>.log(d);</span><br></pre></td></tr></table></figure>

<h4 id="6、解构赋值"><a href="#6、解构赋值" class="headerlink" title="6、解构赋值"></a>6、解构赋值</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解构能让我们从对象或者数组里取出数据存储为变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">var</span> people1 = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;bai&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">color</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>]</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> myName = people1.name;</span><br><span class="line"><span class="keyword">var</span> myAge = people1.age;</span><br><span class="line"><span class="keyword">var</span> myColor = people1.color[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">console</span>.log(myName + <span class="string">&#x27;----&#x27;</span> + myAge + <span class="string">&#x27;----&#x27;</span> + myColor);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> people2 = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;ming&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">color</span>: [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解构</span></span><br><span class="line"><span class="keyword">let</span> &#123; name, age &#125; = people2;</span><br><span class="line"><span class="keyword">let</span> [first, second] = people2.color;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;name&#125;</span>----<span class="subst">$&#123;age&#125;</span>----<span class="subst">$&#123;first&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7、default函数默认参数"><a href="#7、default函数默认参数" class="headerlink" title="7、default函数默认参数"></a>7、default函数默认参数</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES5 给函数定义参数默认值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">	num = num || <span class="number">200</span>;</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">num = <span class="number">200</span></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8、rest-arguments-（rest参数）"><a href="#8、rest-arguments-（rest参数）" class="headerlink" title="8、rest arguments （rest参数）"></a>8、rest arguments （rest参数）</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解决了 es5 复杂的 arguments 问题</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x, y, ...rest</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(rest); <span class="comment">// &#x27;hello&#x27; true 7</span></span><br><span class="line">	<span class="keyword">return</span> ((x + y) * rest.length);</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;hello&#x27;</span>, <span class="literal">true</span>, <span class="number">7</span>); <span class="comment">// 9</span></span><br></pre></td></tr></table></figure>

<h4 id="9、展开运算符"><a href="#9、展开运算符" class="headerlink" title="9、展开运算符"></a>9、展开运算符</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//合并数组</span></span><br><span class="line"><span class="keyword">let</span> color = [<span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;yellow&#x27;</span>];</span><br><span class="line"><span class="keyword">let</span> colorful = [...color, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;blue&#x27;</span>];</span><br><span class="line"><span class="built_in">console</span>.log(colorful); <span class="comment">// [&quot;red&quot;, &quot;yellow&quot;, &quot;green&quot;, &quot;blue&quot;]</span></span><br><span class="line"><span class="comment">//获取其他几项的值</span></span><br><span class="line"><span class="keyword">let</span> num = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>];</span><br><span class="line"><span class="keyword">let</span> [first, second, ...rest] = num;</span><br><span class="line"><span class="built_in">console</span>.log(rest); <span class="comment">// [5, 7, 9, 11]</span></span><br></pre></td></tr></table></figure>

<h4 id="10、对象简写"><a href="#10、对象简写" class="headerlink" title="10、对象简写"></a>10、对象简写</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对象初始化简写</span></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">people</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="attr">name</span>: name,</span><br><span class="line">		<span class="attr">age</span>: age</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">people</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		name,</span><br><span class="line">		age</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对象字面量简写</span></span><br><span class="line"><span class="comment">// ES5</span></span><br><span class="line"><span class="keyword">var</span> people1 = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;bai&#x27;</span>,</span><br><span class="line">	<span class="attr">getName</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line"><span class="keyword">let</span> people2 = &#123;</span><br><span class="line">	<span class="attr">name</span>: <span class="string">&#x27;bai&#x27;</span>,</span><br><span class="line">	getName () &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="built_in">this</span>.name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ES6 对象提供了Object.assign()这个方法来实现浅复制。</span></span><br><span class="line"><span class="comment">//Object.assign()可以把任意多个源对象自身可枚举的属性拷贝给目标对象，然后返回目标对象。第一参数即为目标对象。在实际项目中，我们为了不改变源对象。一般会把目标对象传为&#123;&#125;</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">Object</span>.assign(&#123;&#125;, objA, objB)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 给对象添加属性</span></span><br><span class="line"><span class="built_in">this</span>.seller = <span class="built_in">Object</span>.assign(&#123;&#125;, <span class="built_in">this</span>.seller, response.data)</span><br></pre></td></tr></table></figure>

<h4 id="11、Generators"><a href="#11、Generators" class="headerlink" title="11、Generators"></a>11、Generators</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//生成器（Generator）是能返回一个迭代器的函数</span></span><br><span class="line"><span class="comment">//生成器也是一种函数，最直观的表现就是比普通的function多了一个星号*，在其函数体内可以使用yield关键字,有意思的是函数会在每个yield后暂停。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这里生活中有一个比较形象的例子。咱们到银行办理业务时候都得向大厅的机器取一张排队号。你拿到你的排队号，机器并不会自动为你再出下一张票。也就是说取票机“暂停”住了，直到下一个人再次唤起才会继续吐票。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//迭代器：当你调用一个generator时，它将返回一个迭代器对象。这个迭代器对象拥有一个叫做next的方法来帮助你重启generator函数并得到下一个值。next方法不仅返回值，它返回的对象具有两个属性：done和value。value是你获得的值，done用来表明你的generator是否已经停止提供值。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//继续用刚刚取票的例子，每张排队号就是这里的value，打印票的纸是否用完就这是这里的done。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">createIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 生成器能像正规函数那样被调用，但会返回一个迭代器</span></span><br><span class="line"><span class="keyword">let</span> iterator = createIterator();</span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(iterator.next().value); <span class="comment">// 1</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next().value); <span class="comment">// 2</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next().value); <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//迭代器对异步编程作用很大，异步调用对于我们来说是很困难的事，我们的函数并不会等待异步调用完再执行，你可能会想到用回调函数，（当然还有其他方案比如Promise比如Async/await）。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//生成器可以让我们的代码进行等待。就不用嵌套的回调函数。使用generator可以确保当异步调用在我们的generator函数运行一下行代码之前完成时暂停函数的执行。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//那么问题来了，咱们也不能手动一直调用next()方法，你需要一个能够调用生成器并启动迭代器的方法。就像这样子的：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">taskDef</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 假如taskDef 是一个生成器函数</span></span><br><span class="line">    <span class="comment">// 创建迭代器，让它在别处可用</span></span><br><span class="line">    <span class="keyword">let</span> task = taskDef();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 启动任务</span></span><br><span class="line">    <span class="keyword">let</span> result = task.next();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 递归使用函数来保持对 next() 的调用</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 如果还有更多要做的</span></span><br><span class="line">        <span class="keyword">if</span> (!result.done) &#123;</span><br><span class="line">        	result = task.next();</span><br><span class="line">        	step();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 开始处理过程</span></span><br><span class="line">    step();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="12、Promise"><a href="#12、Promise" class="headerlink" title="12、Promise"></a>12、Promise</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用同步的方法去写异步代码</span></span><br><span class="line"><span class="comment">// 发起异步请求</span></span><br><span class="line">fetch(<span class="string">&#x27;/api/todos&#x27;</span>)</span><br><span class="line">.then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">.then(<span class="function"><span class="params">data</span> =&gt;</span> (&#123;</span><br><span class="line">	data</span><br><span class="line">&#125;))</span><br><span class="line">.catch(<span class="function"><span class="params">err</span> =&gt;</span> (&#123;</span><br><span class="line">err</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>

<h4 id="13、async-await"><a href="#13、async-await" class="headerlink" title="13、async await"></a>13、async await</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// generator函数</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> readFile = <span class="function"><span class="keyword">function</span> (<span class="params">fileName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    fs.readFile(fileName, <span class="function"><span class="keyword">function</span>(<span class="params">error, data</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (error) <span class="keyword">return</span> reject(error);</span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> gen = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">yield</span> readFile(<span class="string">&#x27;/etc/fstab&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">yield</span> readFile(<span class="string">&#x27;/etc/shells&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// async函数</span></span><br><span class="line"><span class="keyword">const</span> asyncReadFile = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">await</span> readFile(<span class="string">&#x27;/etc/fstab&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">await</span> readFile(<span class="string">&#x27;/etc/shells&#x27;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// async函数对 Generator 函数的改进，体现在以下四点。</span></span><br><span class="line"><span class="comment">// 1、内置执行器</span></span><br><span class="line">	<span class="comment">// Generator 函数的执行必须靠执行器，所以才有了co模块，而async函数自带执行器。也就是说，async函数的执行，与普通函数一模一样，只要一行。</span></span><br><span class="line">	asyncReadFile();</span><br><span class="line">	<span class="comment">// 上面的代码调用了asyncReadFile函数，然后它就会自动执行，输出最后结果。这完全不像 Generator 函数，需要调用next方法，或者用co模块，才能真正执行，得到最后结果。</span></span><br><span class="line"><span class="comment">// 2、更好的语义</span></span><br><span class="line">	<span class="comment">// async和await，比起星号和yield，语义更清楚了。async表示函数里有异步操作，await表示紧跟在后面的表达式需要等待结果。</span></span><br><span class="line"><span class="comment">// 3、更广的适用性</span></span><br><span class="line">	<span class="comment">// co模块约定，yield命令后面只能是 Thunk 函数或 Promise 对象，而async函数的await命令后面，可以是 Promise 对象和原始类型的值（数值、字符串和布尔值，但这时会自动转成立即 resolved 的 Promise 对象）。</span></span><br><span class="line"><span class="comment">// 4、返回值是Promise</span></span><br><span class="line">	<span class="comment">// async函数的返回值是 Promise 对象，这比 Generator 函数的返回值是 Iterator 对象方便多了。你可以用then方法指定下一步的操作。</span></span><br><span class="line">	<span class="comment">// 进一步说，async函数完全可以看作多个异步操作，包装成的一个 Promise 对象，而await命令就是内部then命令的语法糖。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//async函数有多种使用形式</span></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数表达式</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象的方法</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="keyword">async</span> <span class="function"><span class="title">foo</span>(<span class="params"></span>)</span> &#123;&#125; &#125;;</span><br><span class="line">obj.foo().then(...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Class 的方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.cachePromise = caches.open(<span class="string">&#x27;avatars&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="function"><span class="title">getAvatar</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cache = <span class="keyword">await</span> <span class="built_in">this</span>.cachePromise;</span><br><span class="line">    <span class="keyword">return</span> cache.match(<span class="string">`/avatars/<span class="subst">$&#123;name&#125;</span>.jpg`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> storage = <span class="keyword">new</span> Storage();</span><br><span class="line">storage.getAvatar(<span class="string">&#x27;jake&#x27;</span>).then(…);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="keyword">async</span> () =&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误处理</span></span><br><span class="line"><span class="comment">// 防止出错的方法，也是将其放在try...catch代码块之中。（推荐使用）</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;出错了&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">await</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 多个await命令</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> val1 = <span class="keyword">await</span> firstStep();</span><br><span class="line">    <span class="keyword">const</span> val2 = <span class="keyword">await</span> secondStep(val1);</span><br><span class="line">    <span class="keyword">const</span> val3 = <span class="keyword">await</span> thirdStep(val1, val2);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;Final: &#x27;</span>, val3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意：根据语法规格，await命令只能出现在 async 函数内部，否则都会报错。</span></span><br></pre></td></tr></table></figure>

<h4 id="14、Set-和-Map数据结构"><a href="#14、Set-和-Map数据结构" class="headerlink" title="14、Set 和 Map数据结构"></a>14、Set 和 Map数据结构</h4><p><strong>Set</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ES6提供了新的数据结构Set和Map。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//基本使用，Set本身是一个构造函数，用来生成Set数据结构</span></span><br><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>();</span><br><span class="line"></span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>].forEach(<span class="function"><span class="params">x</span> =&gt;</span> s.add(x));</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">of</span> s) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2 3 5 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Set函数可以接收一个数组作为参数，用来初始化</span></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>]);</span><br><span class="line">[...set] <span class="comment">// [1, 2, 3, 4, 5]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;div&#x27;</span>));</span><br><span class="line">set.size <span class="comment">// 56</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 字符串去重</span></span><br><span class="line">[...new <span class="built_in">Set</span>(<span class="string">&#x27;ababbcbbd&#x27;</span>)].join(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">// &quot;abcd&quot;</span></span><br><span class="line"><span class="comment">// 数组去重</span></span><br><span class="line">[...new <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>])]</span><br><span class="line"><span class="comment">// [1, 2, 3, 4]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Set 结构的实例有以下属性。</p>
<ul>
<li><code>Set.prototype.constructor</code>：构造函数，默认就是<code>Set</code>函数。</li>
<li><code>Set.prototype.size</code>：返回<code>Set</code>实例的成员总数。</li>
</ul>
<p>Set 实例的方法分为两大类：操作方法（用于操作数据）和遍历方法（用于遍历成员）。下面先介绍四个操作方法。</p>
<ul>
<li><code>Set.prototype.add(value)</code>：添加某个值，返回 Set 结构本身。</li>
<li><code>Set.prototype.delete(value)</code>：删除某个值，返回一个布尔值，表示删除是否成功。</li>
<li><code>Set.prototype.has(value)</code>：返回一个布尔值，表示该值是否为<code>Set</code>的成员。</li>
<li><code>Set.prototype.clear()</code>：清除所有成员，没有返回值。</li>
</ul>
<p>Set 结构的实例有四个遍历方法，可以用于遍历成员。</p>
<ul>
<li><code>Set.prototype.keys()</code>：返回键名的遍历器</li>
<li><code>Set.prototype.values()</code>：返回键值的遍历器</li>
<li><code>Set.prototype.entries()</code>：返回键值对的遍历器</li>
<li><code>Set.prototype.forEach()</code>：使用回调函数遍历每个成员</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果想在遍历操作中，同步改变原来的 Set 结构，目前没有直接的方法，但有两种变通方法。</span></span><br><span class="line"><span class="comment">// 一种是利用原 Set 结构映射出一个新的结构，然后赋值给原来的 Set 结构；</span></span><br><span class="line"><span class="comment">// 另一种是利用Array.from方法。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法一</span></span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">set = <span class="keyword">new</span> <span class="built_in">Set</span>([...set].map(<span class="function"><span class="params">val</span> =&gt;</span> val * <span class="number">2</span>));</span><br><span class="line"><span class="comment">// set的值是2, 4, 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二</span></span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">set = <span class="keyword">new</span> <span class="built_in">Set</span>(<span class="built_in">Array</span>.from(set, <span class="function"><span class="params">val</span> =&gt;</span> val * <span class="number">2</span>));</span><br><span class="line"><span class="comment">// set的值是2, 4, 6</span></span><br></pre></td></tr></table></figure>

<p><strong>Map</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript 的对象（Object），本质上是键值对的集合（Hash 结构），但是传统上只能用字符串当作键。这给它的使用带来了很大的限制。</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> element = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;myDiv&#x27;</span>);</span><br><span class="line"></span><br><span class="line">data[element] = <span class="string">&#x27;metadata&#x27;</span>;</span><br><span class="line">data[<span class="string">&#x27;[object HTMLDivElement]&#x27;</span>] <span class="comment">// &quot;metadata&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面代码原意是将一个 DOM 节点作为对象data的键，但是由于对象只接受字符串作为键名，所以element被自动转为字符串[object HTMLDivElement]。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 为了解决这个问题，ES6 提供了 Map 数据结构。它类似于对象，也是键值对的集合，但是“键”的范围不限于字符串，各种类型的值（包括对象）都可以当作键。也就是说，Object 结构提供了“字符串—值”的对应，Map 结构提供了“值—值”的对应，是一种更完善的 Hash 结构实现。如果你需要“键值对”的数据结构，Map 比 Object 更合适。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> m = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="keyword">const</span> o = &#123;<span class="attr">p</span>: <span class="string">&#x27;Hello World&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">m.set(o, <span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">m.get(o) <span class="comment">// &quot;content&quot;</span></span><br><span class="line"></span><br><span class="line">m.has(o) <span class="comment">// true</span></span><br><span class="line">m.delete(o) <span class="comment">// true</span></span><br><span class="line">m.has(o) <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面的例子展示了如何向 Map 添加成员。作为构造函数，Map 也可以接受一个数组作为参数。该数组的成员是一个个表示键值对的数组。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>],</span><br><span class="line">  [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;Author&#x27;</span>]</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// 实际上执行的下面的算法：</span></span><br><span class="line"><span class="keyword">const</span> items = [</span><br><span class="line">  [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>],</span><br><span class="line">  [<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;Author&#x27;</span>]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">items.forEach(<span class="function">(<span class="params">key, value</span>) =&gt;</span> map.set(key, value));</span><br><span class="line"></span><br><span class="line">map.size <span class="comment">// 2</span></span><br><span class="line">map.has(<span class="string">&#x27;name&#x27;</span>) <span class="comment">// true</span></span><br><span class="line">map.get(<span class="string">&#x27;name&#x27;</span>) <span class="comment">// &quot;张三&quot;</span></span><br><span class="line">map.has(<span class="string">&#x27;title&#x27;</span>) <span class="comment">// true</span></span><br><span class="line">map.get(<span class="string">&#x27;title&#x27;</span>) <span class="comment">// &quot;Author&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面代码在新建 Map 实例时，就指定了两个键name和title。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果对同一个键多次赋值，后面的值将覆盖前面的值</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map</span><br><span class="line">.set(<span class="number">1</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">.set(<span class="number">1</span>, <span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line">map.get(<span class="number">1</span>) <span class="comment">// &quot;bbb&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果读取一个未知的键，则返回undefined。</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>().get(<span class="string">&#x27;asfddfsasadf&#x27;</span>) <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意，只有对同一个对象的引用，Map 结构才将其视为同一个键。这一点要非常小心。</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map.set([<span class="string">&#x27;a&#x27;</span>], <span class="number">555</span>);</span><br><span class="line">map.get([<span class="string">&#x27;a&#x27;</span>]) <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// 上面代码的set和get方法，表面是针对同一个键，但实际上这是两个不同的数组实例，内存地址是不一样的，因此get方法无法读取该键，返回undefined。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 同理，同样的值的两个实例，在 Map 结构中被视为两个键。</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"><span class="keyword">const</span> k1 = [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="keyword">const</span> k2 = [<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">map</span><br><span class="line">.set(k1, <span class="number">111</span>)</span><br><span class="line">.set(k2, <span class="number">222</span>);</span><br><span class="line">map.get(k1) <span class="comment">// 111</span></span><br><span class="line">map.get(k2) <span class="comment">// 222</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 上面代码中，变量k1和k2的值是一样的，但是它们在 Map 结构中被视为两个键。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//由上可知，Map 的键实际上是跟内存地址绑定的，只要内存地址不一样，就视为两个键。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果 Map 的键是一个简单类型的值（数字、字符串、布尔值），则只要两个值严格相等，Map 将其视为一个键，比如0和-0就是一个键，布尔值true和字符串true则是两个不同的键。另外，undefined和null也是两个不同的键。虽然NaN不严格相等于自身，但 Map 将其视为同一个键。</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line">map.set(-<span class="number">0</span>, <span class="number">123</span>);</span><br><span class="line">map.get(+<span class="number">0</span>) <span class="comment">// 123</span></span><br><span class="line"></span><br><span class="line">map.set(<span class="literal">true</span>, <span class="number">1</span>);</span><br><span class="line">map.set(<span class="string">&#x27;true&#x27;</span>, <span class="number">2</span>);</span><br><span class="line">map.get(<span class="literal">true</span>) <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">map.set(<span class="literal">undefined</span>, <span class="number">3</span>);</span><br><span class="line">map.set(<span class="literal">null</span>, <span class="number">4</span>);</span><br><span class="line">map.get(<span class="literal">undefined</span>) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">map.set(<span class="literal">NaN</span>, <span class="number">123</span>);</span><br><span class="line">map.get(<span class="literal">NaN</span>) <span class="comment">// 123</span></span><br></pre></td></tr></table></figure>

<p>Map 结构的实例有以下属性和操作方法：</p>
<ul>
<li>size 属性</li>
<li>Map.prototype.set(key, value)</li>
<li>Map.prototype.get(key)</li>
<li>Map.prototype.has(key)</li>
<li>Map.prototype.delete(key)</li>
<li>Map.prototype.clear()</li>
</ul>
<p>遍历方法：</p>
<p>Map 结构原生提供三个遍历器生成函数和一个遍历方法。</p>
<ul>
<li><code>Map.prototype.keys()</code>：返回键名的遍历器。</li>
<li><code>Map.prototype.values()</code>：返回键值的遍历器。</li>
<li><code>Map.prototype.entries()</code>：返回所有成员的遍历器。</li>
<li><code>Map.prototype.forEach()</code>：遍历 Map 的所有成员。</li>
</ul>
<p>需要特别注意的是，Map 的遍历顺序就是插入顺序。</p>
<h4 id="15、JS新增遍历方法"><a href="#15、JS新增遍历方法" class="headerlink" title="15、JS新增遍历方法"></a>15、JS新增遍历方法</h4><h5 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历的key,key为string类型，也会循环原型链中的属性，适用于对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> obj)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key+<span class="string">&#x27;:&#x27;</span>+obj[key]) <span class="comment">//name:小明 age:18 hobby:run,song,game</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="for-of"><a href="#for-of" class="headerlink" title="for of"></a>for of</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历的value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> arr)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value) <span class="comment">//2 4 6 56 7 88</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> arr.entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key+<span class="string">&#x27;:&#x27;</span>+value); <span class="comment">//0:2 1:4 2:6 3:56 4:7 5:88</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> [key, value] <span class="keyword">of</span> <span class="built_in">Object</span>.entries(obj)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key+<span class="string">&#x27;:&#x27;</span>+value); <span class="comment">//name:小明 age:18 hobby:run,song,game</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="forEach"><a href="#forEach" class="headerlink" title="forEach"></a>forEach</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最节省内存的一种，但是不能break，也不能用return</span></span><br><span class="line">arr.forEach(<span class="function">(<span class="params">value,key</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key + <span class="string">&#x27;:&#x27;</span> + value) <span class="comment">//0:2 1:4 2:6 3:56 4:7 5:88</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(obj).forEach(<span class="function">(<span class="params">value</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value) <span class="comment">//&quot;name&quot;, &quot;age&quot;, &quot;hobby&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同forEach写法一样，循环每一个的时候就相当于在内存中新建了一个数据，比较占内存，与forEach不同的是，它可以return。返回数组。</span></span><br><span class="line"></span><br><span class="line">arr.map(<span class="function">(<span class="params">value,index</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(index+<span class="string">&#x27;:&#x27;</span>+value) <span class="comment">//0:2 1:4 2:6 3:56 4:7 5:88</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.values(obj).map(<span class="function">(<span class="params">value,key</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key+<span class="string">&#x27;:&#x27;</span>+value) <span class="comment">//0:小明 1:18 2:run,song,game</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h5 id="object-keys-values"><a href="#object-keys-values" class="headerlink" title="object.keys()/values()"></a>object.keys()/values()</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj)) <span class="comment">// (3) [&quot;name&quot;, &quot;age&quot;, &quot;hobby&quot;]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.values(obj)) <span class="comment">// (3) [&quot;小明&quot;, 18, &quot;run,song,game&quot;]</span></span><br></pre></td></tr></table></figure>

<h5 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h5><p><strong>1、Array.prototype.some()</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 得到一个布尔值，只要有一个符合条件就可返回true</span></span><br><span class="line">arr.some(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item&gt;<span class="number">10</span> <span class="comment">//true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>2、Array.prototype.filter()</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个符合条件的新数组</span></span><br><span class="line">arr.filter(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> item&gt;<span class="number">10</span> <span class="comment">//(2) [56, 88]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>3、Array.prototype.find() – 查找目标元素</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回符合条件的数组的值或数组的对象，找不到返回undefined</span></span><br><span class="line"><span class="comment">// value：每一次迭代查找的数组元素。</span></span><br><span class="line"><span class="comment">// index：每一次迭代查找的数组元素索引。</span></span><br><span class="line"><span class="comment">// arr：被查找的数组。</span></span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]</span><br><span class="line"><span class="keyword">var</span> ret1 = arr1.find(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value &gt; <span class="number">4</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ret2 = arr1.find(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value &gt; <span class="number">14</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(ret1)</span><br><span class="line"><span class="built_in">console</span>.log(ret2)</span><br><span class="line"><span class="comment">// 5 undefined</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Array</span>.indexof(),findIndex()/includs()查找。返回index/-<span class="number">1</span>,boolean</span><br><span class="line"><span class="built_in">Array</span>.prototype.fill(填充的值，开始索引，结束索引)[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].fill(<span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>); </span><br><span class="line"><span class="comment">// [1, 4, 3]</span></span><br></pre></td></tr></table></figure>

<p><strong>4、Array.prototype.findIndex() – 查找目标元素</strong>**</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//findIndex()函数查找目标元素，找到就返回元素的位置，找不到就返回-1。</span></span><br><span class="line"><span class="keyword">var</span> ret3 = arr1.findIndex(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value &gt; <span class="number">4</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ret4 = arr1.findIndex(<span class="function">(<span class="params">value, index, arr</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value &gt; <span class="number">14</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(ret3)</span><br><span class="line"><span class="built_in">console</span>.log(ret4)</span><br><span class="line"><span class="comment">// 4 -1</span></span><br></pre></td></tr></table></figure>

<p><strong>5、Array.prototype.every()</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 遍历所有元素，得到一个bool值，要所有条件都相符才会返回true</span></span><br><span class="line">arr.every(<span class="function"><span class="params">x</span> =&gt;</span>&#123; x &gt;= <span class="number">10</span>&#125;); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<p><strong>6、Array reduce()方法</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reduce() 方法接收一个函数作为累加器，数组中的每个值（从左到右）开始缩减，最终计算为一个值。</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> ad = arr.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">i,j</span>)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> i+j;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>

<p><strong>7、Array reduceRight()方法</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reduceRight()方法,和 reduce() 功能是一样的，它是从数组的末尾处向前开始计算。</span></span><br><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">let</span> ad = arr.reduceRight(<span class="function"><span class="keyword">function</span>(<span class="params">i,j</span>)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> i+j;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 6</span></span><br></pre></td></tr></table></figure>



<h3 id="2、Node基础"><a href="#2、Node基础" class="headerlink" title="2、Node基础"></a>2、Node基础</h3><p>node.js是一个JavaScript运行环境</p>
<p>node官网：<a target="_blank" rel="noopener" href="http://nodejs.cn/">http://nodejs.cn/</a></p>
<h3 id="3、npm-amp-amp-npx-amp-amp-nvm"><a href="#3、npm-amp-amp-npx-amp-amp-nvm" class="headerlink" title="3、npm &amp;&amp; npx &amp;&amp; nvm"></a>3、npm &amp;&amp; npx &amp;&amp; nvm</h3><h4 id="npm-node-package-manager-："><a href="#npm-node-package-manager-：" class="headerlink" title="npm (node package manager)："></a>npm (node package manager)：</h4><p>​        node包管理器，主要管理node包安装，卸载、更新、查看、搜索和发布。将开发者从繁琐的包管</p>
<p>理工作（版本、依赖）中解放出来。nodejs已经集成了npm，所以安装nodejs的时候npm也一并安装好</p>
<p>了。</p>
<p>​        <strong>通常情况下，我们也可以安装yarn或者使用cnpm淘宝镜像来下载node包</strong></p>
<h4 id="npx："><a href="#npx：" class="headerlink" title="npx："></a>npx：</h4><p>是什么？</p>
<p>​        npx是一个工具，npm v5.2.0引入的一条命令（npx），一个npm包执行器</p>
<p>有什么用及使用？</p>
<p>​        1、<strong>最重要的一点就是再也不需要全局安装任何工具只需要<code>npx &lt;commang&gt;</code></strong></p>
<blockquote>
<p>​        当在执行npx <command>的时候，npx会做如下操作：</p>
<p>​                帮你在本地（可以是项目中的也可以是本机的）寻找这个 command</p>
<p>  ​                        找到了： 就用本地的版本</p>
<p>  ​                        没找到： 直接下载最新版本，完成命令要求</p>
<p>​                使用完之后不会在你的本机或者项目留下任何东西            </p>
</blockquote>
<p>​        2、不会污染版本机</p>
<p>​        3、永远使用最新版本的dependency</p>
<p>​        4、帮助切换版本</p>
<blockquote>
<p>​        假设你本机安装的node版本是node@8，但是你的项目可能需要使用使用node@6做测试，如果你有nvm，可以使用<code>nvm use v8.11</code>，其实npx也可以帮你做成。</p>
<p>​        使用<code>npx -p node@6 npm run test</code></p>
<p>​                npx会帮助你下载node@6        </p>
<p>​                将此时的环境变成node@6版本</p>
<p>​                使用node@6帮你执行npm run test</p>
<p>​                命令执行完毕之后不会修改你原来的node版本</p>
<p>​        指令可以理解为使用node@6版本运行<code>npm run test</code></p>
</blockquote>
<p>​        5、任何command都通过npx在machine任何位置使用</p>
<blockquote>
<p>举个例子，在某一个项目中使用<code>npm install --save-dev @babel/core @babel/cli</code>安装babel。此时：<br>你在命令行中使用<code>babel script.js</code>一定会报错说babel不存在，即便你的<code>node_module</code>中babel静静的躺在那里，你只有两种方式可以使用babel：</p>
<p>你可以通过在<code>package.json</code>的script中使用babel去compile某一个directory（用<code>npm run-script</code>的形式）</p>
<p>你也可以通过使用<code>./node_modules/.bin/babel script.js</code>用babel去compile某一个script文件（使用babel包中的可执行文件）</p>
<p>那么他的局限性就很大：</p>
<p>虽然你的node_module中有babel，等价于你的machine上有babel，但是你不能方便的在任何位置使用<code>babel</code>，只能通过以上的两种方式。</p>
<p>但是有了npx在任何位置使用babel command似乎就不是难题了：</p>
<p>当你任何位置（根目录下/项目根目录下）运行<code>npx babel script.js</code>不会再报错说<code>babel</code>不存在了：</p>
<p>npx会帮你找到本机下的babel然后运行</p>
</blockquote>
<p>​        6、帮助执行<code>one-off</code>指令</p>
<blockquote>
<p>​                对于一些工具，比如<code>create-react-app</code>，它们有些特性：</p>
<p>​                        可能很久才会被使用一次</p>
<p>​                        安装包会很大</p>
<p>​                我们似乎真的没必要将他们都安装到电脑上，所以可以直接使用<code>npx tool-command</code></p>
</blockquote>
<p>​        7、通过SHELL AUTO FALLBACK 将npx作为所有指令找不到时的fallback地址</p>
<p>在你的命令行配置文件中（~/.bashrc, ~/.zshrc, ~/.config/fish/config.fish）配置以下指令：</p>
<blockquote>
<p>For bash@&gt;=4:</p>
<p>​    <code>$ source &lt;(npx --shell-auto-fallback bash)</code></p>
<p>For zsh@&gt;=4:</p>
<p>​    <code>$ source &lt;(npx --shell-auto-fallback zsh)</code></p>
<p>For fish@&gt;=4:</p>
<p>​    <code>$ source (npx --shell-auto-fallback fish | psub)</code></p>
</blockquote>
<p><img src="./A70CC736-A50D-4446-9AA0-DF45BA899664.png" alt="A70CC736-A50D-4446-9AA0-DF45BA899664"></p>
<h4 id="nvm-node-version-manager-："><a href="#nvm-node-version-manager-：" class="headerlink" title="nvm (node version manager)："></a>nvm (node version manager)：</h4><p>​        <strong>nvm —- node多版本管理器</strong></p>
<p>​        在开发中，我们可能同时在进行多个 node 项目，而这些不同的项目所使用的 node 版本又是不一样的，或者是要用更新的 node 版本进行试验和学习。</p>
<p>​        这种情况下，对于维护多个版本的 node 将会是一件非常麻烦的事情，而 nvm 就是为解决这个问题而产生的，他可以方便的在同一台设备上进行多个 node 版本之间切换。</p>
<h3 id="4、webpack（资源模块化管理和打包工具）"><a href="#4、webpack（资源模块化管理和打包工具）" class="headerlink" title="4、webpack（资源模块化管理和打包工具）"></a>4、webpack（资源模块化管理和打包工具）</h3><p>官网文档：<a target="_blank" rel="noopener" href="https://www.webpackjs.com/concepts/">https://www.webpackjs.com/concepts/</a></p>
<h2 id="二、项目搭建"><a href="#二、项目搭建" class="headerlink" title="二、项目搭建"></a>二、项目搭建</h2><h3 id="1、使用脚手架"><a href="#1、使用脚手架" class="headerlink" title="1、使用脚手架"></a>1、使用脚手架</h3><p>1、使用脚手架创建项目：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npx create-react-app my-app <span class="comment">//my-app 为自己的项目文件名（自定义）</span></span><br><span class="line"></span><br><span class="line">查看配置文件：</span><br><span class="line">npm run eject <span class="comment">//此操作不可逆</span></span><br></pre></td></tr></table></figure>

<p>2、删除src目录下所有代码，新建index.js文件，入口文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;./App&#x27;</span></span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, <span class="built_in">document</span>.querySelector(<span class="string">&quot;#root&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>3、新建App.js文件或App.jsx文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//React中，可以使用JSX来描述UI，用来解耦和DOM操作，react只做逻辑层，reactDOM去渲染实际的dom；移动端例外，如果为移动端，可以使用其他的渲染库</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>( </span><br><span class="line">      <span class="comment">//在return中就可以添加你想渲染到页面上的东西</span></span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyComponent</span><br></pre></td></tr></table></figure>

<h3 id="2、使用webpack"><a href="#2、使用webpack" class="headerlink" title="2、使用webpack"></a>2、使用webpack</h3><p>####<strong>初始化项目</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir diy-webpack-<span class="keyword">for</span>-react</span><br><span class="line">cd diy-webpack-<span class="keyword">for</span>-react</span><br><span class="line">npm init -y</span><br></pre></td></tr></table></figure>

<p>添加<code>.gitignore</code>文件(git上传过滤文件)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node_modules</span><br><span class="line">/dist</span><br><span class="line"></span><br><span class="line">.idea</span><br><span class="line">.vscode</span><br></pre></td></tr></table></figure>

<p>初始化git仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<p>安装webpack</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<h4 id="配置webpack-config-js"><a href="#配置webpack-config-js" class="headerlink" title="配置webpack.config.js"></a><strong>配置webpack.config.js</strong></h4><p>配置思路：</p>
<ul>
<li>配置入口（entry）</li>
<li>配置输出（output）</li>
<li>配置各种资源加载的loader</li>
<li>使用HtmlWebpackPlugin将打包后的js入口文件的脚本注入到html模板中</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装依赖</span></span><br><span class="line"></span><br><span class="line">babel-loader @babel/core @babel/preset-env @babel/preset-react</span><br><span class="line"></span><br><span class="line">style-loader css-loader</span><br><span class="line"></span><br><span class="line">url-loader</span><br><span class="line"></span><br><span class="line">html-webpack-plugin</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js代码配置如下：</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 设置为生产（production）模式</span></span><br><span class="line">  <span class="comment">// 生产模式默认会将js代码压缩</span></span><br><span class="line">  <span class="comment">// 如果你好奇打包后的文件长什么样</span></span><br><span class="line">  <span class="comment">// 可以将mode设置为&quot;development&quot;，将devtool设为&quot;none&quot;</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="comment">// 设置入口文件</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 设置出口文件名</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">    <span class="comment">// 设置出口文件的目录</span></span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">// 设置扩展，这样导入文件时可以省去写扩展名</span></span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.json&quot;</span>, <span class="string">&quot;.jsx&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">       <span class="comment">// 对&quot;.js&quot;或&quot;.jsx&quot;结尾的文件使用babel-loader进行转译</span></span><br><span class="line">       <span class="comment">// babel-loader的配置放到&quot;.babelrc&quot;文件内</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">        use: <span class="string">&quot;babel-loader&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 对css文件先后使用css-loader和style-loader</span></span><br><span class="line">        <span class="comment">// css-loader可以将导入项目的css变为js模块</span></span><br><span class="line">        <span class="comment">// style-loader可以让页面打开时，利用js将css模块</span></span><br><span class="line">        <span class="comment">// 内的样式注入到html头部的style标签内</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 使用file-loader来加载图片文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg|svg|gif)$/</span>,</span><br><span class="line">        use: <span class="string">&quot;file-loader&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 该插件能将生成的入口js文件注入到模板html内</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      <span class="comment">// 设置模板的路径</span></span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/template.html&quot;</span>,</span><br><span class="line">      <span class="comment">// 设置favicon的路径</span></span><br><span class="line">      <span class="attr">favicon</span>: <span class="string">&quot;./src/assets/favicon-32x32-next.png&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="配置-babelrc"><a href="#配置-babelrc" class="headerlink" title="配置.babelrc"></a><strong>配置.babelrc</strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//我们需要配置.babelrc文件，来告诉babel我们要使用的presets。</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>, <span class="string">&quot;@babel/preset-react&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置npm脚本"><a href="#配置npm脚本" class="headerlink" title="配置npm脚本"></a><strong>配置npm脚本</strong></h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在npm内添加以下脚本，方便开发使用</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config webpack.config.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;serve:dist&quot;</span>: <span class="string">&quot;npx http-server-spa ./dist&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>使用 <code>npm run build</code>，打包项目。使用<code>npm run serve:dist</code>,将打包后的文件跑起来。</p>
<p>一个简单的webpack配置完毕！</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装react和react-dom包依赖</span></span><br><span class="line">npm i react react-dom </span><br><span class="line">或</span><br><span class="line">yarn add react react-dom</span><br></pre></td></tr></table></figure>

<p>现在可以开始写react了！</p>
<h4 id="扩展："><a href="#扩展：" class="headerlink" title="扩展："></a><strong>扩展：</strong></h4><ul>
<li><p>如果有需要可以在前面的基础上对<code>webpack.config.js</code>进行拆分。以适应其他需求</p>
</li>
<li><p>项目开发时，我们需要用<code>webpack-dev-server</code>启动开发服务器，当我们修改文件时，它能自动重新打包项目并刷新页面。</p>
</li>
<li><p>项目打包上线时，我们希望webpack能进行更多的处理来优化打包后的代码。</p>
</li>
<li><p>针对不同的需求，我们需要将配置文件拆分为<code>webpack.common.js  webpack.dev.js  webpack.prod.js</code>。</p>
</li>
</ul>
<p><strong>1、配置webpack.common.js</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此文件是共用的配置。</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// 入口文件改为 .jsx文件</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.jsx&quot;</span>,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.json&quot;</span>, <span class="string">&quot;.jsx&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">        <span class="comment">// include告诉webpack只对src下的</span></span><br><span class="line">        <span class="comment">// js、jsx文件进行babel转译</span></span><br><span class="line">        <span class="comment">// 加快webpack的打包速度</span></span><br><span class="line">        include: path.resolve(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;babel-loader&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>2、配置<code>webpack.dev.js</code></strong></p>
<p>我们需要使用<code>webpack-merge</code>将前面配好的<code>webpack.comm.js</code>合并进来。而且需要<code>webpack-dev-server</code>来启动开发服务器。</p>
<p>安装：</p>
<ul>
<li><code>webpack-merge</code></li>
<li><code>webpack-dev-server</code><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&quot;./webpack.common&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用webpack-merge将webpack.common.js合并进来</span></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  <span class="comment">// 设置为开发（development）模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="comment">// 设置source map,方便debugger</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;inline-source-map&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;main.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 单页应用的前端路由使用history模式时，这个配置很重要</span></span><br><span class="line">    <span class="comment">// webpack-dev-server服务器接受的请求路径没有匹配的资源时</span></span><br><span class="line">    <span class="comment">// 他会返回index.html而不是404页面</span></span><br><span class="line">    <span class="attr">historyApiFallback</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg|svg|gif)$/</span>,</span><br><span class="line">        use: <span class="string">&quot;file-loader&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/template.html&quot;</span>,</span><br><span class="line">      <span class="attr">favicon</span>: <span class="string">&quot;./src/assets/favicon-32x32-next.png&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>3、配置webpack.prod.js</strong></p>
<p>打包生产环境使用的代码需要非常多的优化和处理，所以这个文件的配置会非常复杂。</p>
<p>3.1、配置思路</p>
<p>​    将css样式从main.js内抽离到单独的.css文件</p>
<p>​    缓存处理</p>
<p>​    将第三方库和webpack的runtime从main.js内抽离出来</p>
<p>​    js、css、html代码压缩</p>
<p>​    使用source-map替代inline-source-map</p>
<p>​    懒加载（lazy loading）</p>
<p>​    每次打包前先清空dist目录</p>
<p>3.2、抽离css样式</p>
<p>​    前面的webpack.dev.js只是简单的使用了css-loader和style-loader。</p>
<p>​    css-loader将项目导入的css样式转为js模块，打包到main.js内。</p>
<p>​    style-loader在main.js内提供了一个能将css动态插入到html内的方法。</p>
<p>​    当用户打开页面时，会先加载html,然后加载main.js,最后运行js脚本将样式插入到style标签内。</p>
<p>这样有多个缺点：</p>
<p>​    css被打包到了main.js内，增加了它的文件大小，而且也不方便对css做缓存</p>
<p>​    css样式得等到main.js脚本运行，并插入到html时才会有效果。这个空档期虽然很短，但它会造成界面闪烁。</p>
<p>优点：</p>
<p>​    打包速度快</p>
<p>​    所以style-loader与css-loader的组合仅适用于开发。我们需要使用mini-css-extract插件，并用该插件提供的</p>
<p>loader来替代style-loader。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">  <span class="comment">// 配置mini-css-extract插件</span></span><br><span class="line">  <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="comment">// 设置抽取出来的css名字</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[contentHash].css&quot;</span>,</span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;[id].[contentHash].css&quot;</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">],</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">module</span>:&#123;</span><br><span class="line">  <span class="attr">rules</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      <span class="comment">// 使用MiniCssExtractPlugin.loader替代style-loader</span></span><br><span class="line">      use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>3.3、缓存处理<br>    缓存是前端页面性能优化的重点。我们希望浏览器能长久缓存资源，同时又能在第一时间获取更新后的资源。</p>
<p>具体思路是：后端不对index.html做任何缓存处理，对css、js、图片等资源做持久缓存。将output.filename配置为”main.[contentHash].js”,这样打包后的main.js中间会加上一段contentHash。contentHash是根据打包文件内容产生的，内容改变它才会发生改变。发布时，由于哈希值不同，服务器能同时保存着不同哈希版本的资源。这样保证了发布过程中，用户仍然能够访问到旧资源,并且新用户会访问到新资源。</p>
<p>加上contentHash后打包文件名变成main.xxxxxx.js，其中xxxxxx代表一串很长的哈希值。</p>
<p>但是，现在我们的业务代码、引用的第三方库，还有webpack生成的runtime都被捆绑打包到了main.xxxxxx.js内。第三方库和webpack的runtime变动的频率非常低，所以我们不希望每次业务代码的改动导致用户得连同它们一起重新下载一遍。因此我们需要将它们从main.xxxxxx.js内抽离出来。</p>
<p>还有一点需要注意，webpack以前的版本有个小小的问题。在打包文件内容没发生变化的情况下contentHash任然会发生改变。此时需要使用webpack.HashedModuleIdsPlugin插件来替代默认的哈希生成。虽然webpack4修复了这个问题，但是官方文档还是推荐我们使用webpack.HashedModuleIdsPlugin插件。</p>
<p>3.4、抽离第三方库与webpack runtime<br>    前面已经说明了为什么要抽离他们。</p>
<p>以前的版本使用commons-chunk-plugin插件来抽离第三方库，webpack 4通过配置optimization.splitChunks来抽取。内部其实使用了split-chunks-plugin插件。</p>
<p>将optimization.runtimeChunk选项配置为single,可以将webpack runtime抽离到单文件中。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="comment">// 抽离webpack runtime到单文件</span></span><br><span class="line">  <span class="attr">runtimeChunk</span>: <span class="string">&quot;single&quot;</span>,</span><br><span class="line">  <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">    <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">    <span class="comment">// 最大初始请求数量</span></span><br><span class="line">    <span class="attr">maxInitialRequests</span>: <span class="literal">Infinity</span>,</span><br><span class="line">    <span class="comment">// 抽离体积大于80kb的chunk</span></span><br><span class="line">    <span class="attr">minSize</span>: <span class="number">80</span> * <span class="number">1024</span>,</span><br><span class="line">    <span class="comment">// 抽离被多个入口引用次数大于等于1的chunk</span></span><br><span class="line">    <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">      <span class="comment">// 抽离node_modules下面的第三方库</span></span><br><span class="line">      <span class="attr">vendor</span>: &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        <span class="comment">// 从模块的路径地址中获得库的名称</span></span><br><span class="line">        name: <span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">module</span>, chunks, chacheGroupKey</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">const</span> packageName = <span class="built_in">module</span>.context.match(</span><br><span class="line">            <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">          )[<span class="number">1</span>];</span><br><span class="line">          <span class="keyword">return</span> <span class="string">`vendor_<span class="subst">$&#123;packageName.replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>3.5、js、css、html代码压缩<br>打包后的js、css、html会有注释、空格、换行，开启代码压缩可以大幅度减少资源的体积。</p>
<p>在mode设为”production”时，会默认使用terser-webpack-plugin插件对js进行压缩。我们还要开启html与css的压缩，所以要重写optimization.minimizer选项。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">minimizer</span>: [</span><br><span class="line">    <span class="comment">// 压缩css</span></span><br><span class="line">    <span class="keyword">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class="line">    <span class="comment">// 压缩js,记得sourceMap设为true</span></span><br><span class="line">    <span class="keyword">new</span> TerserWebpackPlugin(&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">    <span class="comment">// 该插件还能对html进行压缩</span></span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/template.html&quot;</span>,</span><br><span class="line">      <span class="attr">favicon</span>: <span class="string">&quot;./src/assets/favicon-32x32-next.png&quot;</span>,</span><br><span class="line">      <span class="attr">minify</span>: &#123;</span><br><span class="line">        <span class="comment">// 折叠空白符（去除换行符和空格）</span></span><br><span class="line">        <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 移除注释</span></span><br><span class="line">        <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 移除属性上不必要的引号</span></span><br><span class="line">        <span class="attr">removeAttributeQuotes</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>3.6、使用source-map替代inline-source-map<br>发生bug时，我们很难通过打包后的代码找出错误的源头。所以我们需要source map将代码映射为原来我们手写时候的样子。</p>
<p>前面的webpack.dev.js内使用的是inline-source-map。它的缺点是将map内敛到了代码内，这样用户会连同资源将map一起下载。</p>
<p>所以我们使用source-map,它会给打包后的每个js单独生成.map文件。</p>
<p>3.7、懒加载（lazy loading）<br>懒加载也叫按需加载。我们当前打包的所有js会在页面加载过程中被加载运行。但是大多数情况下，用户并不会访问应用的所有页面与功能。我们可以将每个页面的代码或一些不常使用的功能模块做成按需加载，这样可以大大减小用户初次访问时所要加载的资源大小。</p>
<p>懒加载是webpack4默认支持的，不需要任何配置。前端人员需要在开发时使用dynamic import按需引入模块。webpack会自动将dynamic import引入的模块单独打包为一个chunk（注意：dynamic import语法上需要babel插件的支持，会在下一章节提到该插件）。</p>
<p>webpack官网提供的例子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// print.js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;The print.js module has loaded! See the network tab in dev tools...&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;Button Clicked: Here\&#x27;s &quot;some text&quot;!&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">button.onclick = <span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;print&quot; */</span> <span class="string">&#x27;./print&#x27;</span>).then(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> print = <span class="built_in">module</span>.default;</span><br><span class="line"></span><br><span class="line">  print();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p>通过点击按钮，触发加载print模块。/* webpackChunkName: “print” */这个注释告诉webpack该模块打包成的chunk名字叫print。</p>
<p>3.8、清空dist目录<br>使用clean-webpack-plugin在打包前清空dist目录。</p>
<p>3.9、webpack.prod.js的完整配置<br>安装：</p>
<p>mini-css-extract-plugin<br>clean-webpack-plugin<br>terser-webpack-plugin optimize-css-assets-webpack-plugin<br>url-loader</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&quot;webpack-merge&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&quot;./webpack.common&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> CleanWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> OptimizeCssAssetsWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;optimize-css-assets-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(common, &#123;</span><br><span class="line">  <span class="comment">// 设置为生产（production）模式</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="comment">// 在生产环境中使用&quot;source-map&quot;而不是&quot;inline-source-map&quot;</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 这里添加contentHash</span></span><br><span class="line">    <span class="comment">// 由于我们的entry中没有配置入口的名称</span></span><br><span class="line">    <span class="comment">// webpack会默认取名为main</span></span><br><span class="line">    <span class="comment">// 因此这里的配置会生成&quot;main.xxxxxx.js&quot;</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].[contentHash].js&quot;</span>,</span><br><span class="line">    <span class="comment">// 通过splitChunks抽离的js文件名格式</span></span><br><span class="line">    <span class="attr">chunkFilename</span>: <span class="string">&quot;[name].[contentHash].chunk.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// 这里使用MiniCssExtractPlugin.loader替代style-loader</span></span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|jpeg|svg|gif)$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          <span class="comment">// 这里使用url-loader替代file-loader</span></span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="comment">// 当图片小于8kb时，url-loader会将图片转为base64</span></span><br><span class="line">            <span class="comment">// 这样可以减少http请求的数量</span></span><br><span class="line">            <span class="comment">// 如果大于8kb的话，url-loader会将图片交给file-loader处理</span></span><br><span class="line">            <span class="comment">// 所以url-loader需要依赖file-loader</span></span><br><span class="line">            <span class="attr">limit</span>: <span class="number">1024</span> * <span class="number">8</span>,</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;img/[name].[hash:8].[ext]&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="comment">// 抽离webpack runtime到单文件</span></span><br><span class="line">    <span class="attr">runtimeChunk</span>: <span class="string">&quot;single&quot;</span>,</span><br><span class="line">    <span class="comment">// 压缩器</span></span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="comment">// 压缩css</span></span><br><span class="line">      <span class="keyword">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class="line">      <span class="comment">// 压缩js，记得将sourceMap设为true</span></span><br><span class="line">      <span class="comment">// 否则会无法生成source map</span></span><br><span class="line">      <span class="keyword">new</span> TerserWebpackPlugin(&#123; <span class="attr">sourceMap</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">      <span class="comment">// 该插件还能压缩html</span></span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        <span class="attr">template</span>: <span class="string">&quot;./src/template.html&quot;</span>,</span><br><span class="line">        <span class="attr">favicon</span>: <span class="string">&quot;./src/assets/favicon-32x32-next.png&quot;</span>,</span><br><span class="line">        <span class="attr">minify</span>: &#123;</span><br><span class="line">          <span class="comment">// 折叠空白符</span></span><br><span class="line">          <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 移除注释</span></span><br><span class="line">          <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 移除属性多余的引号</span></span><br><span class="line">          <span class="attr">removeAttributeQuotes</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">      <span class="comment">// 最大初始请求数</span></span><br><span class="line">      <span class="attr">maxInitialRequests</span>: <span class="literal">Infinity</span>,</span><br><span class="line">      <span class="comment">// 80kb以上的chunk抽离为单独的js文件</span></span><br><span class="line">      <span class="comment">// 配合上面的 maxInitialRequests: Infinity</span></span><br><span class="line">      <span class="comment">// 小于80kb的所有chunk会被打包一起</span></span><br><span class="line">      <span class="comment">// 这样可以减少初始请求数</span></span><br><span class="line">      <span class="comment">// 大家可以根据自己的情况设置</span></span><br><span class="line">      <span class="attr">minSize</span>: <span class="number">80</span> * <span class="number">1024</span>,</span><br><span class="line">      <span class="comment">// 抽离多入口引用次数1以上的chunk</span></span><br><span class="line">      <span class="attr">minChunks</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="comment">// 抽离node_modules内的第三方库</span></span><br><span class="line">        <span class="attr">vendor</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="comment">// 根据路径获得第三方库的名称</span></span><br><span class="line">          <span class="comment">// 并将抽离的chunk以&quot;vendor_thirdPartyLibrary&quot;格式命名</span></span><br><span class="line">          name: <span class="function"><span class="keyword">function</span>(<span class="params"><span class="built_in">module</span>, chunks, chacheGroupKey</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">const</span> packageName = <span class="built_in">module</span>.context.match(</span><br><span class="line">              <span class="regexp">/[\\/]node_modules[\\/](.*?)([\\/]|$)/</span></span><br><span class="line">            )[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`vendor_<span class="subst">$&#123;packageName.replace(<span class="string">&quot;@&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;</span>`</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 每次打包前，先清除输出目录</span></span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">    <span class="comment">// 抽离css</span></span><br><span class="line">    <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;[name].[contentHash].css&quot;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&quot;[id].[contentHash].css&quot;</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 确保在文件没发生改变时，contentHash也不会变化</span></span><br><span class="line">    <span class="keyword">new</span> webpack.HashedModuleIdsPlugin()</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>4、配置npm脚本</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack-dev-server --config webpack.dev.js&quot;</span>,</span><br><span class="line">  <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --config webpack.prod.js&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<p><strong>5、结尾</strong></p>
<p>基本配置完成,可以安装react-router redux进行单页应用开发了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i react-router-dom redux react-redux redux-thunk</span><br></pre></td></tr></table></figure>



<h2 id="三、知识点梳理"><a href="#三、知识点梳理" class="headerlink" title="三、知识点梳理"></a>三、知识点梳理</h2><p>官网网址：<a target="_blank" rel="noopener" href="https://zh-hans.reactjs.org/docs/introducing-jsx.html">https://zh-hans.reactjs.org/docs/introducing-jsx.html</a></p>
<h3 id="1、JSX"><a href="#1、JSX" class="headerlink" title="1、JSX"></a>1、JSX</h3><p><strong>什么是JSX？</strong>  </p>
<pre><code> JSX是对js语法扩展，使我们可以用类似xml方式描述视图
</code></pre>
<p>**为什么需要JSX?  **  </p>
<p>​    执行快、类型安全、简单快速</p>
<p><strong>原理？</strong>     </p>
<p>​    babel-loader会预编译JSX为React.createElement(type,props,…chilrden)</p>
<p><strong>怎么用？</strong>  </p>
<h4 id="1、介绍示例"><a href="#1、介绍示例" class="headerlink" title="1、介绍示例"></a>1、介绍示例</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyDemo color=<span class="string">&quot;color&quot;</span>&gt;&lt;/MyDemo&gt;</span><br><span class="line"><span class="comment">//简写为： 通常情况下，主要是看该组件是否有子代来决定是否保留闭合标签</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyDemo</span> <span class="attr">color</span>=<span class="string">&quot;color&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">//通过JSX的语法，则转化为：</span></span><br><span class="line">React.createElement(</span><br><span class="line">    MyDemo,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&quot;blue&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="2、在React中必须声明引入React"><a href="#2、在React中必须声明引入React" class="headerlink" title="2、在React中必须声明引入React"></a>2、在React中必须声明引入React</h4><p>原因： 由于，使用了jsx语法，因此，jsx会进行编译解析，解析之后的文件就需要引入React<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> CustomButton <span class="keyword">from</span> <span class="string">&#x27;./CustomButton&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">WarningButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 返回 React.createElement(CustomButton, &#123;color: &#x27;red&#x27;&#125;, null);</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">CustomButton</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span></span><br><span class="line"><span class="keyword">import</span> MyDemo1 <span class="keyword">from</span> <span class="string">&quot;./mydemo1.jsx&quot;</span></span><br><span class="line"><span class="keyword">import</span> MyDemo2 <span class="keyword">from</span> <span class="string">&quot;./mydemo2.jsx&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Total</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">MyDemo1</span> <span class="attr">color</span>=<span class="string">&quot;red&quot;</span> <span class="attr">width</span>=<span class="string">&quot;120&quot;</span> /&gt;</span></span></span><br><span class="line">        <span class="comment">//这里，组件会编译为：React.createElement(MyDemo1,&#123;color:&quot;red&quot;, width: &quot;120&quot;&#125;, null)</span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Total</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123; <span class="comment">//当然，如果这里使用的是class组件，引入React肯定也是必须要的</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="xml"><span class="tag">&lt;<span class="name">MyDemo2</span> <span class="attr">color</span>=<span class="string">&quot;skyblue&quot;</span> <span class="attr">width</span>=<span class="string">&quot;80&quot;</span> &gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>我是作为children传递过去MyDemo2组件中的子组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">MyDemo2</span> /&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">MyDemo2</span>&gt;</span></span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3、点表示语法"><a href="#3、点表示语法" class="headerlink" title="3、点表示语法"></a>3、点表示语法</h4><p>可以在一个模块中导出多个React组件<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponents = &#123;</span><br><span class="line">    <span class="attr">DatePicker</span>: <span class="function"><span class="keyword">function</span> <span class="title">DatePicker</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>date picker<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">Time</span>: <span class="function"><span class="keyword">function</span> <span class="title">Time</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>time<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Components</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">MyComponents.DatePicker</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4、首字母大写"><a href="#4、首字母大写" class="headerlink" title="4、首字母大写"></a>4、首字母大写</h4><p>由于JSX内置机制，<br>小写字母开头的元素(<div> / <span> / <p>…)会被传递给React.createElement;<br>大写字母开头的元素(<Components />)会被编译为React.createElement(Components)</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误！组件名应该首字母大写:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正确！div 是有效的 HTML 标签:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.toWhat&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HelloWorld</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 错误！React 会将小写开头的标签名认为是 HTML 原生标签:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">hello</span> <span class="attr">toWhat</span>=<span class="string">&quot;World&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确！组件名应该首字母大写:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正确！div 是有效的 HTML 标签:</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.toWhat&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HelloWorld</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 正确！React 能够将大写开头的标签名认为是 React 组件。</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Hello</span> <span class="attr">toWhat</span>=<span class="string">&quot;World&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hello</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123; <span class="comment">//组件名大写</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> <span class="comment">//标签小写</span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5、运行时选择类型"><a href="#5、运行时选择类型" class="headerlink" title="5、运行时选择类型"></a>5、运行时选择类型</h4><p>不能使用JSX表达式来作为React元素的标签<br>（如果你想通过表达式来确定react元素的类型，请先将其赋值给大写开头的变量。这种情况下，一般会在你想通过属性值条件渲染组件时出现）</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误示例</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; PhotoStory, VideoStory &#125; <span class="keyword">from</span> <span class="string">&#x27;./Storise&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = &#123;</span><br><span class="line">    <span class="attr">photo</span>: PhotoStory,</span><br><span class="line">    <span class="attr">video</span>: VideoStory</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Story</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  	<span class="comment">// 错误！JSX 标签名不能为一个表达式。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml">&lt;components[props.storyType] story=&#123;props.story&#125; /&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//正确示例</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; PhotoStory, VideoStory &#125; <span class="keyword">from</span> <span class="string">&#x27;./Storise&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> components = &#123;</span><br><span class="line">    <span class="attr">photo</span>: PhotoStory,</span><br><span class="line">    <span class="attr">video</span>: VideoStory</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Story</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  	<span class="comment">// 正确！JSX 标签名可以为大写开头的变量。</span></span><br><span class="line">    <span class="keyword">const</span> SpecificStory = components[props.storyType]</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SpecificStory</span> <span class="attr">story</span>=<span class="string">&#123;props.story&#125;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6、属性"><a href="#6、属性" class="headerlink" title="6、属性"></a>6、属性</h4><p>在JSX中有几种不同的方式来指定属性</p>
<p>6.1使用JavaScript表达式<br>使用{}包裹JavaScript表达式作为一个属性值。</p>
<p>注意：if语句和for循环在JavaScript中不是表达式，因此他们不能直接在JSX中使用，只能在周围使用（即return之外）</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyComponent sum=&#123; <span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span> + <span class="number">4</span> &#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>6.2字符串常量<br>可以将字符串常量作为属性值传递<br>如果遇到转义字符串，则该值会被解析为HTML转义字符串</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyComponent message=<span class="string">&quot;hello&quot;</span> title=<span class="string">&quot;&lt;3&quot;</span> /&gt;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;<span class="attr">hello</span>&#x27;&#125; <span class="attr">title</span>=<span class="string">&quot;<span class="symbol">&amp;lt;</span>3&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="7、默认值为true"><a href="#7、默认值为true" class="headerlink" title="7、默认值为true"></a>7、默认值为true</h4><p>如果没有给属性传值，它的默认值为true<br>注意：不推荐使用。因为会与ES6简洁语法混淆，这里能使用，是因为它符合HTML的做法</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyTextBox foo /&gt;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyTextBox</span> <span class="attr">foo</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="comment">//注意：不推荐使用。因为会与ES6简洁语法混淆，这里能使用，是因为它符合HTML的做法</span></span><br></pre></td></tr></table></figure>

<h4 id="8、扩展属性"><a href="#8、扩展属性" class="headerlink" title="8、扩展属性"></a>8、扩展属性</h4><p>如果你已经有了一个props对象，并且想在JSX中传递，可以使用 … 作为扩展操作符来传递整个属性对象。</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> <span class="attr">firstName</span>=<span class="string">&quot;Ben&quot;</span> <span class="attr">lastName</span>=<span class="string">&quot;Hector&quot;</span> /&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> props = &#123;<span class="attr">firstName</span>: <span class="string">&quot;Ben&quot;</span>, <span class="attr">lastName</span>: <span class="string">&quot;Hector&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="9、子代"><a href="#9、子代" class="headerlink" title="9、子代"></a>9、子代</h4><p>在包含开始和结束标签的JSX表达式中，标记之间的内容作为特殊的参数传递:<br>props.children。有几种不同的方法来传递子代</p>
<p>9.1字符串常量传递<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyComponent&gt;hello world!&lt;/MyComponent&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world! <span class="symbol">&amp;amp;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>9.2JSX组件传递<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyContainer&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">MyFirstComponent</span> /&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">MySecondComponent</span> /&gt;</span></span></span><br><span class="line">&lt;/MyContainer&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  Here is a list:</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>Item 2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//使用数组的形式返回多个元素</span></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">  <span class="comment">// 不需要使用额外的元素包裹数组中的元素</span></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">// 不要忘记 key 值</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;A&quot;</span>&gt;</span>First item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>,</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;B&quot;</span>&gt;</span>Second item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>,</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&quot;C&quot;</span>&gt;</span>Third item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>,</span><br><span class="line">  ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9.3、JavaScript表达式<br>可以将任何{}包裹的JavaScript表达式作为子代传递。<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyComponent&gt;foo&lt;/MyComponent&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyComponent</span>&gt;</span>&#123;&#x27;foo&#x27;&#125;<span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这对于渲染任意长度的 JSX 表达式的列表很有用。例如，下面将会渲染一个 HTML 列表：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Item</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;props.message&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">TodoList</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> todos = [<span class="string">&#x27;finish doc&#x27;</span>, <span class="string">&#x27;submit pr&#x27;</span>, <span class="string">&#x27;nag dan to review&#x27;</span>];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;todos.map((message) =&gt; <span class="tag">&lt;<span class="name">Item</span> <span class="attr">key</span>=<span class="string">&#123;message&#125;</span> <span class="attr">message</span>=<span class="string">&#123;message&#125;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// JavaScript 表达式可以与其他类型的子代混合使用。这通常对于字符串模板非常有用：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello &#123;props.addressee&#125;!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9.4函数<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Calls the children callback numTimes to produce a repeated component</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Repeat</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> items = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.numTimes; i++) &#123;</span><br><span class="line">    items.push(props.children(i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;items&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ListOfTenThings</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Repeat</span> <span class="attr">numTimes</span>=<span class="string">&#123;10&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;(index) =&gt; <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>This is item &#123;index&#125; in the list<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Repeat</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>9.5布尔值、NULL和undefined被忽略<br>false、null、undefined 和 true 都是有效的子代，但它们不会直接被渲染。<br>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以下表达式为等价的</span></span><br><span class="line">&lt;div /&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;false&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;null&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;undefined&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;true&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据条件来确定是否渲染React元素。</span></span><br><span class="line"><span class="comment">// 以下的JSX只会在showHeader为true时渲染&lt;Header /&gt;组件。</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;showHeader &amp;&amp; <span class="tag">&lt;<span class="name">Header</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Content</span> /&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 值得注意的是，JavaScript 中的一些 “falsy” 值(比如数字0)，它们依然会被渲染。例如，下面的代码不会像你预期的那样运行，因为当 props.message 为空数组时，它会打印0:</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;props.messages.length &amp;&amp;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">MessageList</span> <span class="attr">messages</span>=<span class="string">&#123;props.messages&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="comment">// 要解决这个问题，请确保 &amp;&amp; 前面的表达式始终为布尔值：</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;props.messages.length &gt; 0 &amp;&amp;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">MessageList</span> <span class="attr">messages</span>=<span class="string">&#123;props.messages&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 相反，如果你想让类似 false、true、null 或 undefined 出现在输出中，你必须先把它转换成字符串 :</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  My JavaScript variable is &#123;String(myVariable)&#125;.</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="2、虚拟DOM-和-DIFF算法"><a href="#2、虚拟DOM-和-DIFF算法" class="headerlink" title="2、虚拟DOM 和 DIFF算法"></a>2、虚拟DOM 和 DIFF算法</h3><h4 id="虚拟DOM"><a href="#虚拟DOM" class="headerlink" title="虚拟DOM"></a>虚拟DOM</h4><blockquote>
<p>页面结构 -  DOM(对象) - 虚拟DOM(对象)</p>
</blockquote>
<blockquote>
<p>DOM：浏览器中为了表现页面结构使用JS对象对元素进行模拟。</p>
<p>虚拟DOM: 框架中为了表示DOM元素使用JS对象对DOM进行模拟。</p>
<p><strong>虚拟DOM的本质</strong>: 就是JS的对象,用于模拟页面DOM的嵌套关系。</p>
<p><strong>虚拟DOM的目的</strong>: 实现页面的高效更新。</p>
<p><strong>虚拟DOM实现高效更新的过程</strong>:</p>
<ol>
<li>页面在第一次渲染时,内存中存在对象A(虚拟DOM)</li>
<li>当页面发生变化时,在内存中生成一个新的对象B(虚拟DOM)</li>
<li>对对象A和对象B进行对比,找出有差异的地方，存储到内存中C(虚拟DOM)</li>
<li>在页面进行渲染时,只渲染C即可实现高效更新。</li>
</ol>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tree属性的对比 相当于TreeDIff</span></span><br><span class="line"><span class="comment">// 属性名称的对比,相当于ComponentDiff</span></span><br><span class="line"><span class="comment">// 属性值的对比, 相当于ElementDiff</span></span><br><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">	<span class="attr">tree</span>:<span class="string">&#x27;A&#x27;</span></span><br><span class="line">    <span class="attr">name</span>:<span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">	<span class="attr">tree</span>:<span class="string">&#x27;B&#x27;</span></span><br><span class="line">	<span class="attr">name</span>:<span class="string">&#x27;ls&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Diff算法"><a href="#Diff算法" class="headerlink" title="Diff算法"></a>Diff算法</h4><blockquote>
<p><strong>TreeDIff</strong>:最顶层的对比,判断连个虚拟DOM树类型是否一样,如果不一样，则直接渲染新虚拟DOM,如果一样，再实现ComponentDiff</p>
<p><strong>ComponentDiff</strong>:如果虚拟DOM类型一样,再对比组件类型是否一样,如果不一样,直接记录当前组件，接着对比下一个组件；如果一样，再实现ElementDiff</p>
<p><strong>ElementDiff</strong>：如果组件类型一样，再对比组件中的元素是否一样，如果不一样,记录下来,找到所有记录的内容(虚拟DOM)，最后渲染这个虚拟DOM</p>
</blockquote>
<p><img src="./dom1.png" alt="dom1"></p>
<p><img src="./dom2.png" alt="dom2"></p>
<p><img src="./dom3.png" alt="dom3"></p>
<h3 id="3、state-amp-amp-props"><a href="#3、state-amp-amp-props" class="headerlink" title="3、state &amp;&amp; props"></a>3、state &amp;&amp; props</h3><p><strong>props 是组件对外的接口，state 是组件对内的接口</strong></p>
<p>主要区别：</p>
<ul>
<li><p>State是可变的，是一组用于反映组件UI变化的状态集合；</p>
</li>
<li><p>而Props对于使用它的组件来说，是只读的，要想修改Props，只能通过该组件的父组件修改。</p>
<p>在组件状态上移的场景中，父组件正是通过子组件的Props, 传递给子组件其所需要的状态。</p>
</li>
</ul>
<h4 id="setState-数据更新"><a href="#setState-数据更新" class="headerlink" title="setState()数据更新"></a>setState()数据更新</h4><blockquote>
<p>在react中如果需要修改state中的数据,需要使用<code>this.setState(&#123;&#125;)</code>进行修改，只有这种方式对数据进行修改之后，可以触发视图的更新。</p>
<p>注意: <code>this.setState(&#123;&#125;)</code>方法是一个<strong>异步方法</strong>,如果需要在修改数据之后离开对数据进行使用，需要提供第二个参数-回调函数。</p>
<p>会将所有需要更新的setState全部拿到之后，<strong>批量操作，一次执行</strong></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">btnClick = <span class="function">(<span class="params">arg</span>)=&gt;</span>&#123;</span><br><span class="line">     <span class="comment">// this.setState(&#123;</span></span><br><span class="line">     <span class="comment">//   msg:&#x27;hello&#x27;</span></span><br><span class="line">     <span class="comment">// &#125;)</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">msg</span>:<span class="number">123</span></span><br><span class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span>.state.msg)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="props"><a href="#props" class="headerlink" title="props"></a>props</h4><p><strong>props(属性) 默认为 “true”</strong></p>
<p>如果你没给 prop(属性) 传值，那么他默认为 true 。下面两个 JSX 表达式是等价的：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;MyTextBox autocomplete /&gt;</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">MyTextBox</span> <span class="attr">autocomplete</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>


<p>通常情况下，我们不建议使用这种类型，因为这会与ES6中的对象shorthand混淆 。ES6 shorthand 中 {foo} </p>
<p>指的是 {foo: foo} 的简写，而不是 {foo: true} 。这种行为只是为了与 HTML 的行为相匹配。</p>
<p>(举个例子，在 HTML 中，&lt; input type=“radio” value=“1” disabled /&gt; 与 &lt; input type=“radio” value=“1” </p>
<p>disabled=“true” /&gt; 是等价的。JSX 中的这种行为就是为了匹配 HTML 的行为。)</p>
<p><strong>props扩展</strong></p>
<p>如果你已经有一个 object 类型的 props，并且希望在 JSX 中传入，你可以使用扩展操作符 … 传入整个 props </p>
<p>对象。这两个组件是等效的：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> <span class="attr">firstName</span>=<span class="string">&quot;Ben&quot;</span> <span class="attr">lastName</span>=<span class="string">&quot;Hector&quot;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> props = &#123;<span class="attr">firstName</span>: <span class="string">&#x27;Ben&#x27;</span>, <span class="attr">lastName</span>: <span class="string">&#x27;Hector&#x27;</span>&#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、生命周期"><a href="#4、生命周期" class="headerlink" title="4、生命周期"></a>4、生命周期</h3><h4 id="属性校验"><a href="#属性校验" class="headerlink" title="属性校验"></a>属性校验</h4><blockquote>
<p>属性校验是在组件内部对传进来的外界属性的类型进行校验,主要是为了增加程序的健壮性，当传递数据的类型不符合要求时,可以在控制台做出警告提示。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 安装prop-types模块并导入</span></span><br><span class="line">yarn add prop-types</span><br><span class="line"><span class="keyword">import</span> Types <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 在组件内部定义静态属性propTypes</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Com</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Componnet</span></span>&#123;</span><br><span class="line">  	<span class="comment">//这里涉及到了ES6的class，我们定义一个组件的时候通常是定义了一个类，而static则是创建了一个属于这个类的属性或者方法。</span></span><br><span class="line">	<span class="comment">//组件则是这个类的一个实例，component的props和state是属于这个实例的，所以实例还未创建，我们又怎么可能读得到props和state呢？</span></span><br><span class="line">	<span class="comment">//总结来说static并不是react定义的，而加上static关键字，就表示该方法不会被实例继承，而是直接通过类来调用</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 2.1 静态属性 propTypes 设置需要校验的属性</span></span><br><span class="line">    <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">        <span class="comment">// count 这个属性值只接受数值类型</span></span><br><span class="line">        <span class="attr">count</span>:Types.number,</span><br><span class="line">        <span class="attr">msg</span>:Types.string.isRequired</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2.2 静态属性 defaultProps 设置需要校验的属性的默认值</span></span><br><span class="line">    <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">		<span class="attr">count</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="attr">msg</span>:<span class="string">&#x27;hello&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构造函数(不属于生命周期函数)</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">super</span>()</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//写法1：如上</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//写法2：</span></span><br><span class="line">    Com.propTypes = &#123;</span><br><span class="line">      <span class="attr">name</span>: PropTypes.string</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="旧版生命周期函数"><a href="#旧版生命周期函数" class="headerlink" title="旧版生命周期函数"></a>旧版生命周期函数</h4><p><img src="./shengming.png" alt="shengming"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Life</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">	<span class="comment">// 构造函数(不属于生命周期函数)</span></span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">		<span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 组件的创建阶段(3个函数) */</span> </span><br><span class="line">    <span class="comment">// 执行时机: 组件在内存中被创建出来，然后所有的属性和实例方法都已经挂载完毕</span></span><br><span class="line">    <span class="comment">// 特点(只执行1次): 可以访问当前组件的属性和方法,通常用于数据初始化和发送异步请求(类似vue的created)</span></span><br><span class="line">    <span class="function"><span class="title">componentWillMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行时机：当前组件需要被渲染到真实页面时执行,此时仅仅只是在内存中建立好了虚拟DOM对象</span></span><br><span class="line">    <span class="comment">// 特点(1次以上): 用于创建当前组件的DOM结构</span></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                jsx虚拟DOM</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行时机: 数据全部挂载完毕,同时所有的虚拟DOM都已经被渲染成真实DOM</span></span><br><span class="line">    <span class="comment">// 特点(只执行1次)：可以在这个函数中操作真实DOM(类似vue中的mounted)</span></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 组件的运行阶段(4个函数) */</span> </span><br><span class="line">    <span class="comment">// 执行时机: 组件所接收的外界数据props发生变化的时候触发</span></span><br><span class="line">    <span class="comment">// 特点: 在这个函数中可以通过形参nextProps获取到最新的props数据</span></span><br><span class="line">    <span class="function"><span class="title">componentWillReceiveProps</span>(<span class="params">nextProps</span>)</span>&#123;</span><br><span class="line">		<span class="comment">// this.props里面是旧值</span></span><br><span class="line">        <span class="comment">// nextProps里面是最新的值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行时机: state或props中的数据发生变化时会触发该函数</span></span><br><span class="line">    <span class="comment">// 特点: 根据该函数内部return值决定组件是否需要被重新更新(渲染)</span></span><br><span class="line">    <span class="function"><span class="title">shouldComponentUpdate</span>(<span class="params">nextProps,nextState</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// this.state.xxx 旧值</span></span><br><span class="line">        <span class="comment">// nextSatte 新值</span></span><br><span class="line">        <span class="comment">// this.props.xxx 旧值</span></span><br><span class="line">        <span class="comment">// nextProps 新值</span></span><br><span class="line">        <span class="comment">// return true会执行后续生命周期函数,会重新渲染组件</span></span><br><span class="line">        <span class="comment">// return false不会执行后续生命周期,组件不会重新渲染</span></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 执行时机: 当shouldComponentUpdate内部return true时会执行该函数</span></span><br><span class="line">    <span class="comment">// 特点: 当前组件的状态(props,state)已经是最新值,但是DOM中绑定的数据还是旧值，即DOM还没有被更新(类似vue中的beforeUpdate)</span></span><br><span class="line">    <span class="function"><span class="title">componentWillUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">// this.state.xxx 新值</span></span><br><span class="line">        <span class="comment">// this.props.xxx 新值</span></span><br><span class="line">        <span class="comment">// 真实DOM中的数据还是旧的</span></span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">	<span class="comment">// 注意: componentWillUpdate 执行完毕之后会立刻重新执行 render 函数,然后将最新数据渲染到虚拟DOM中</span></span><br><span class="line">        </span><br><span class="line">	<span class="comment">// 执行时机: 虚拟DOM被渲染到真实DOM中会执行该函数</span></span><br><span class="line">   	<span class="comment">// 特点: 组件的状态和当前DOM界面都是最新的,已经完成了同步(类似vue中的updated)</span></span><br><span class="line">    <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="comment">// this.state.xxx 新值</span></span><br><span class="line">        <span class="comment">// this.props.xxx 新值</span></span><br><span class="line">        <span class="comment">// 真实DOM中的数据还是新的</span></span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/* 组件销毁阶段(1个函数) */</span></span><br><span class="line">    <span class="comment">// 执行时机: 组件即将被销毁,但是还没有被销毁时执行</span></span><br><span class="line">    <span class="comment">// 特点: 还可以继续访问组件的属性和方法,在这个函数中可以做一些数据的清理工作,防止内存泄露</span></span><br><span class="line">    <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Life;</span><br></pre></td></tr></table></figure>

<h4 id="React16新版生命周期函数"><a href="#React16新版生命周期函数" class="headerlink" title="React16新版生命周期函数"></a>React16新版生命周期函数</h4><p><img src="./Newshengming.jpg" alt="Newshengming"></p>
<p>对于异步渲染，现在渲染有两个阶段：<code>reconciliation</code> 和 <code>commit</code> 。前者过程是可以打断的，后者不能暂停，会一直更新界面直到完成。</p>
<p><strong>Reconciliation</strong> 阶段（diff阶段）</p>
<ul>
<li><code>componentWillMount</code></li>
<li><code>componentWillReceiveProps</code></li>
<li><code>shouldComponentUpdate</code></li>
<li><code>componentWillUpdate</code></li>
</ul>
<p><strong>Commit</strong> 阶段（DOM操作阶段）</p>
<ul>
<li><code>componentDidMount</code></li>
<li><code>componentDidUpdate</code></li>
<li><code>componentWillUnmount</code></li>
</ul>
<p>因为<code>reconciliation</code>阶段是可以被打断的，所以<code>reconciliation</code>阶段会执行的生命周期函数就可能出现调用多次的情况，从而引起BUG。</p>
<p>所以对于<code>reconciliation</code>阶段调用的几个函数，除了<code>shouldComponentUpdate</code>以外，其他的都应该避免去使用，进而在新的react版本中，引入了新的API来解决这个问题。</p>
<p><code>getDerivedStateFromProps</code> 用于替换 <code>componentWillReceiveProps</code> ，该函数会在初始化和 <code>update</code> 时被调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewLife</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Initialize state in constructor,</span></span><br><span class="line">  <span class="comment">// Or with a property initializer.</span></span><br><span class="line">  state = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromProps</span>(<span class="params">nextProps, prevState</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (prevState.someMirroredValue !== nextProps.someValue) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">derivedData</span>: computeDerivedState(nextProps),</span><br><span class="line">        <span class="attr">someMirroredValue</span>: nextProps.someValue</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return null to indicate no change to state.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getSnapshotBeforeUpdate</code> 用于替换 <code>componentWillUpdate</code> ，该函数会在 <code>update</code> 后 DOM 更新前被调用，用于读取最新的 DOM 数据。</p>
<p>新生命周期函数的使用示例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewLife</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于初始化 state</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通常，在 React 中，构造函数仅用于以下两种情况：</span></span><br><span class="line">    <span class="comment">// 1、通过给 this.state 赋值对象来初始化内部 state。</span></span><br><span class="line">    <span class="comment">// 2、为事件处理函数绑定实例</span></span><br><span class="line">    </span><br><span class="line">	<span class="comment">//在 constructor() 函数中不要调用 setState() 方法。如果你的组件需要使用内部 state，请直接在构造函数中为 this.state 赋值初始 state：</span></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(props);</span><br><span class="line">      <span class="comment">// 不要在这里调用 this.setState()</span></span><br><span class="line">      <span class="comment">// 避免将 props 的值复制给 state</span></span><br><span class="line">      <span class="comment">// this.state = &#123; color: props.color &#125;;  ----&gt; 错误示范</span></span><br><span class="line">      <span class="built_in">this</span>.state = &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</span><br><span class="line">      <span class="built_in">this</span>.handleClick = <span class="built_in">this</span>.handleClick.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于替换 `componentWillReceiveProps` ，该函数会在初始化和 `update` 时被调用</span></span><br><span class="line">  <span class="comment">// 因为该函数是静态函数，所以取不到 `this`</span></span><br><span class="line">  <span class="comment">// 如果需要对比 `prevProps` 需要单独在 `state` 中维护</span></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromProps</span>(<span class="params">nextProps, prevState</span>)</span> &#123;</span><br><span class="line">      <span class="comment">//getDerivedStateFromProps 会在调用 render 方法之前调用，并且在初始挂载及后续更新时都会被调用。它应返回一个对象来更新 state，如果返回 null 则不更新任何内容。</span></span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 判断是否需要更新组件，多用于组件性能优化</span></span><br><span class="line">  <span class="function"><span class="title">shouldComponentUpdate</span>(<span class="params">nextProps, nextState</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// this.state.xxx 旧值</span></span><br><span class="line">      <span class="comment">// nextSatte 新值</span></span><br><span class="line">      <span class="comment">// this.props.xxx 旧值</span></span><br><span class="line">      <span class="comment">// nextProps 新值</span></span><br><span class="line">      <span class="comment">// return true会执行后续生命周期函数,会重新渲染组件</span></span><br><span class="line">      <span class="comment">// return false不会执行后续生命周期,组件不会重新渲染</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件挂载后调用</span></span><br><span class="line">  <span class="comment">// 可以在该函数中进行请求或者订阅</span></span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用于获得最新的 DOM 数据</span></span><br><span class="line">  <span class="function"><span class="title">getSnapshotBeforeUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="comment">//getSnapshotBeforeUpdate() 在最近一次渲染输出（提交到 DOM 节点）之前调用。它使得组件能在发生更改之前从 DOM 中捕获一些信息（例如，滚动位置）。此生命周期的任何返回值将作为参数传递给 componentDidUpdate()。</span></span><br><span class="line">      <span class="comment">//应返回 snapshot 的值（或 null）。</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件即将销毁</span></span><br><span class="line">  <span class="comment">// 可以在此处移除订阅，定时器等等</span></span><br><span class="line">  <span class="function"><span class="title">componentWillUnmount</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件销毁后调用</span></span><br><span class="line">  <span class="function"><span class="title">componentDidUnMount</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 组件更新后调用</span></span><br><span class="line">  <span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染组件函数</span></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//补充：</span></span><br><span class="line">  <span class="comment">//错误处理</span></span><br><span class="line">    <span class="comment">//当渲染过程，生命周期，或子组件的构造函数中抛出错误时，会调用如下方法：</span></span><br><span class="line">  	<span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromError</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//此生命周期会在后代组件抛出错误后被调用。 它将抛出的错误作为参数，并返回一个值以更新 state</span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="title">componentDidCatch</span>(<span class="params">error, info</span>)</span> &#123;</span><br><span class="line">        <span class="comment">//此生命周期在后代组件抛出错误后被调用。 它接收两个参数：</span></span><br><span class="line">        <span class="comment">//error —— 抛出的错误。</span></span><br><span class="line">        <span class="comment">//info —— 带有 componentStack key 的对象，其中包含有关组件引发错误的栈信息。</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 以下函数不建议使用</span></span><br><span class="line">  <span class="function"><span class="title">UNSAFE_componentWillMount</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="title">UNSAFE_componentWillUpdate</span>(<span class="params">nextProps, nextState</span>)</span> &#123;&#125;</span><br><span class="line">  <span class="function"><span class="title">UNSAFE_componentWillReceiveProps</span>(<span class="params">nextProps</span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>static getDerivedStateFromError()</code>示例如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromError</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 更新 state 使下一次渲染可以显降级 UI</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state.hasError) &#123;</span><br><span class="line">      <span class="comment">// 你可以渲染任何自定��的降级  UI</span></span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.props.children; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注意:</span></span><br><span class="line"><span class="comment">// getDerivedStateFromError() 会在渲染阶段调用，因此不允许出现副作用。 如遇此类情况，请改用 componentDidCatch()。</span></span><br></pre></td></tr></table></figure>

<p><code>componentDidCatch()</code>示例如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// componentDidCatch() 会在“提交”阶段被调用，因此允许执行副作用。 它应该用于记录错误之类的情况：</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">getDerivedStateFromError</span>(<span class="params">error</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// 更新 state 使下一次渲染可以显示降级 UI</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">hasError</span>: <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">componentDidCatch</span>(<span class="params">error, info</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// &quot;组件堆栈&quot; 例子:</span></span><br><span class="line">    <span class="comment">//   in ComponentThatThrows (created by App)</span></span><br><span class="line">    <span class="comment">//   in ErrorBoundary (created by App)</span></span><br><span class="line">    <span class="comment">//   in div (created by App)</span></span><br><span class="line">    <span class="comment">//   in App</span></span><br><span class="line">    logComponentStackToMyService(info.componentStack);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.state.hasError) &#123;</span><br><span class="line">      <span class="comment">// 你可以渲染任何自定义的降级 UI</span></span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Something went wrong.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.props.children; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 注意</span></span><br><span class="line"><span class="comment">// 如果发生错误，你可以通过调用 setState 使用 componentDidCatch() 渲染降级 UI，但在未来的版本中将不推荐这样做。 可以使用静态 getDerivedStateFromError() 来处理降级渲染。</span></span><br></pre></td></tr></table></figure>

<h3 id="5、key的必要性"><a href="#5、key的必要性" class="headerlink" title="5、key的必要性"></a>5、key的必要性</h3><p>为什么需要key？</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这个组件接收 numbers 数组作为参数并输出一个元素列表。</span></span><br><span class="line"><span class="comment">//当我们运行这段代码，将会看到一个警告 a key should be provided for list items，意思是当你创建一个元素时，必须包括一个特殊的 key 属性。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">NumberList</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> numbers = props.numbers;</span><br><span class="line">  <span class="keyword">const</span> listItems = numbers.map(<span class="function">(<span class="params">number</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;number&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItems&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">NumberList</span> <span class="attr">numbers</span>=<span class="string">&#123;numbers&#125;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>key使得React识别出了哪些元素改变，例如删除或被添加。</p>
<p>一个元素的key最好是这个元素在列表中拥有的独一无二的字符串。</p>
<p>通常，我们使用来自数据id来作为元素的key（推荐使用）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todoItems = todos.map(<span class="function">(<span class="params">todo</span>) =&gt;</span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;todo.text&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>在万不得已的情况下，你可以使用元素索引index作为key（不推荐）</p>
<p>注意：如果列表项目顺序可能会变化，我们不推荐使用索引来用作key值，会导致性能的损耗</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todoItems = todos.map(<span class="function">(<span class="params">todo, index</span>) =&gt;</span></span><br><span class="line">  <span class="comment">// Only do this if items have no stable IDs</span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;todo.text&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>key 只是在兄弟节点之间必须唯一</strong></p>
<blockquote>
<p>数组元素中使用的 key 在其兄弟节点之间应该是独一无二的。然而，它们不需要是全局唯一的。当我们生成两个不同的数组时，我们可以使用相同的 key 值</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例如下：</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Blog</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> sidebar = (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;props.posts.map((post) =&gt;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;post.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;post.title&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      )&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">const</span> content = props.posts.map(<span class="function">(<span class="params">post</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;post.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;post.title&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;post.content&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;sidebar&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;content&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> posts = [</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&#x27;Hello World&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;Welcome to learning React!&#x27;</span>&#125;,</span><br><span class="line">  &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;Installation&#x27;</span>, <span class="attr">content</span>: <span class="string">&#x27;You can install React from npm.&#x27;</span>&#125;</span><br><span class="line">];</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Blog</span> <span class="attr">posts</span>=<span class="string">&#123;posts&#125;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="6、容器组件-和-展示组件"><a href="#6、容器组件-和-展示组件" class="headerlink" title="6、容器组件 和 展示组件"></a>6、容器组件 和 展示组件</h3><p>容器组件是处理获取数据、订阅 redux 存储等的组件。它们包含展示组件和其他容器组件，但是里面从来没有html。</p>
<p><strong>展示组件：</strong></p>
<ul>
<li>关注页面的展示效果（外观）。</li>
<li>内部可以包含展示组件和容器组件，通常会包含一些自己的DOM标记和样式(style)。</li>
<li>通常允许通过<code>this.props.children</code>方式来包含其他组件。</li>
<li>对应用程序的其他部分没有依赖关系，例如Flux操作或store。</li>
<li>不用关心数据是怎么加载和变动的。</li>
<li>只能通过props的方式接收数据和进行回调(callback)操作。</li>
<li>很少拥有自己的状态，即使有也是用于展示UI状态的。</li>
<li>会被写成函数式组件除非该组件需要自己的状态，生命周期或者做一些性能优化。</li>
</ul>
<p><strong>容器组件：</strong></p>
<ul>
<li><p>关注应用的是如何工作的。</p>
</li>
<li><p>内部可以包含容器组件和展示组件，但通常没有任何自己的DOM标记，除了一些包装divs，并且从不具有</p>
<p>任何样式。</p>
</li>
<li><p>提供数据和行为给其他的展示组件或容器组件。</p>
</li>
<li><p>调用Flux操作并将它们作为回调函数提供给展示组件。</p>
</li>
<li><p>往往是有状态的，因为它们倾向于作为数据源。</p>
</li>
<li><p>通常使用高阶组件生成，例如React Redux的connect（），Relay的createContainer（）或Flux Utils的</p>
<p>Container.create（），而不是手工编写。</p>
</li>
</ul>
<p>示例：（为区分之前）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">      <span class="built_in">super</span>(props);</span><br><span class="line">      <span class="built_in">this</span>.state =&#123;</span><br><span class="line">          <span class="attr">todos</span>:[]</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.fetchData = <span class="built_in">this</span>.fetchData.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.fetchData();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">fetchData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      fetch(<span class="string">&#x27;/api/todos&#x27;</span>).then(<span class="function"><span class="params">data</span> =&gt;</span>&#123;</span><br><span class="line">          <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">              <span class="attr">todos</span>:data</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;todos&#125; = <span class="built_in">this</span>.state;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#123;todos.map((item,index)=&gt;&#123;</span></span><br><span class="line"><span class="xml">                    return <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">                &#125;)&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例：（区分之后）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展示组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;todos&#125; = <span class="built_in">this</span>.props;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">              &#123;todos.map((item,index)=&gt;&#123;</span></span><br><span class="line"><span class="xml">                return <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span>&#123;item.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">              &#125;)&#125;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TodoListContainer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.state = &#123;</span><br><span class="line">            <span class="attr">todos</span>:[]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.fetchData = <span class="built_in">this</span>.fetchData.bind(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.fetchData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">fetchData</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        fetch(<span class="string">&#x27;/api/todos&#x27;</span>).then(<span class="function"><span class="params">data</span> =&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">                <span class="attr">todos</span>:data</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">              <span class="tag">&lt;<span class="name">TodoList</span> <span class="attr">todos</span>=<span class="string">&#123;this.state.todos&#125;</span> /&gt;</span>    </span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、有状态组件-和-无状态组件"><a href="#7、有状态组件-和-无状态组件" class="headerlink" title="7、有状态组件 和 无状态组件"></a>7、有状态组件 和 无状态组件</h3><h4 id="无状态组件"><a href="#无状态组件" class="headerlink" title="无状态组件"></a>无状态组件</h4><p><strong>无状态组件：通过构造函数方式创建的组件,组件内部没有生命周期函数和私有数据。</strong></p>
<p>无状态组件是一个<strong>纯函数</strong></p>
<p><strong>纯函数</strong>：函数内部对接收到数据不做任何处理,这样的函数称作纯函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以构造函数方式创建</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>构造函数方式创建的组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>	</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以标签的方式使用</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Hello</span> /&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 形参props用于接收传递的属性</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Hello</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>构造函数方式创建的组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;props.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;props.age&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>:<span class="string">&#x27;zs&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>:<span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ReactDOM.render(&lt;Hello username=&#123;obj.name&#125; age=&#123;obj.age&#125; /&gt;,document.getElementById(&#x27;app&#x27;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 属性扩散(使用es6的展开运算符进行传值)</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Hello</span> &#123;<span class="attr">...obj</span>&#125; /&gt;</span></span>,<span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h4 id="有状态组件"><a href="#有状态组件" class="headerlink" title="有状态组件"></a>有状态组件</h4><p><strong>有状态组件：通过class关键字创建的组件,组件内部可以定义生命周期函数和私有数据。</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Home</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>()</span><br><span class="line">        <span class="comment">// 定义私有数据</span></span><br><span class="line">        <span class="built_in">this</span>.state = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">      <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">          <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这是class关键字创建的组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8、组件通信"><a href="#8、组件通信" class="headerlink" title="8、组件通信"></a>8、组件通信</h3><p>React的组件通信基本与Vue中的一致。同样的也分为以下三种情况：</p>
<ul>
<li>父子组件通信</li>
<li>兄弟组件通信</li>
<li>跨多层级组件通信</li>
<li>任意组件之间的通信</li>
</ul>
<h4 id="父子组件通信"><a href="#父子组件通信" class="headerlink" title="父子组件通信"></a><strong>父子组件通信</strong></h4><p>父传子：</p>
<p>父组件通过props传递数据给子组件，子组件通过this.props.xxx获取父组件传递过来的数据</p>
<p>子传父：</p>
<p>子组件通过调用父组件传递过来的函数传递数据给父组件。</p>
<p>示例：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//子组件Son</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//通过this.props.xxx接收父组件传递过来的数据</span></span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onChange</span>=<span class="string">&#123;this.props.onChildChange&#125;/</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子组件ChildButton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChildButton</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="comment">//通过this.props.xxx接收父组件传递过来的数据</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">                <span class="attr">onClick</span>=<span class="string">&#123;this.props.onChildClick.bind(this,</span> &#x27;<span class="attr">data</span>&#x27;)&#125;</span></span></span><br><span class="line"><span class="tag"><span class="xml">            &gt;</span></span></span><br><span class="line"><span class="xml">                提交</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">son</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">data</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">changeHandler</span>(<span class="params">e</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//子组件触发函数后，父组件即可获得子组件传递过来的数据，</span></span><br><span class="line">    <span class="comment">//这里的e.target.value即为input输入的数据</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      <span class="attr">son</span>: e.target.value</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">clickHandle</span>(<span class="params">data</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//子组件触发函数后，父组件即可获得子组件传递过来的数据，</span></span><br><span class="line">    <span class="comment">//data即为子组件传递过来的‘data’</span></span><br><span class="line">    <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">      data</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">          &#123;/* 在这里使用子组件，将函数传递过去 */&#125;</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Son</span> <span class="attr">onChildChange</span>=<span class="string">&#123;this.changeHandler.bind(this)&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">ChildButton</span> <span class="attr">onChildClick</span>=<span class="string">&#123;this.clickHandle.bind(this)&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>这里显示 Son 组件的内容：&#123;this.state.son&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>这里显示 ChildButton 组件的内容：&#123;this.state.data&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">Father</span>/&gt;</span></span>, mountNode);</span><br></pre></td></tr></table></figure>



<h4 id="兄弟组件传值"><a href="#兄弟组件传值" class="headerlink" title="兄弟组件传值"></a><strong>兄弟组件传值</strong></h4><p>对于这种情况可以通过共同的父组件来管理状态和事件函数。</p>
<p>比如说其中一个兄弟组件调用父组件传递过来的事件函数修改父组件中的状态，然后父组件将状态传递给另一个兄弟组件。</p>
<p>示例类似于上</p>
<h4 id="跨多层级组件通信"><a href="#跨多层级组件通信" class="headerlink" title="跨多层级组件通信"></a><strong>跨多层级组件通信</strong></h4><p>在16.3以上版本中，可以使用Context API</p>
<p>示例如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Context，可以在开始就传入值</span></span><br><span class="line"><span class="keyword">const</span> StateContext = React.createContext()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="comment">// value 就是传入 Context 中的值</span></span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">StateContext.Provider</span> <span class="attr">value</span>=<span class="string">&#x27;yck&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Child</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">StateContext.Provider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">ThemeContext.Consumer</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;/* 取出值 */&#125;</span></span><br><span class="line"><span class="xml">        &#123;context =&gt; (</span></span><br><span class="line"><span class="xml">          name is &#123; context &#125;</span></span><br><span class="line"><span class="xml">        )&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">ThemeContext.Consumer</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="任意组件之间的通信"><a href="#任意组件之间的通信" class="headerlink" title="任意组件之间的通信"></a><strong>任意组件之间的通信</strong></h4><p>1、引入Redux，通过Redux在内存中开辟一块新的空间，存储数据，使所有的组件都能够访问存储在Redux中的数据，当然它也提供了存储数据的方法（推荐使用）</p>
<p>Redux是JavaScript状态管理容器，提供可预测化的状态管理。类似于vue中的vuex。</p>
<p>这里给大家推荐一篇较好的博客来说明：<a target="_blank" rel="noopener" href="https://github.com/brickspert/blog/issues/22">https://github.com/brickspert/blog/issues/22</a></p>
<p><img src="./redux_.png" alt="redux_"></p>
<blockquote>
<p>action就是动作，也就是通过动作来修改state的值。也是修改store的唯一途径。</p>
<p>Store表示的是整个的数据存储中心，集中大部分页面需要的状态以及数据；</p>
<p>ActionCreators表示的是view 视图层与data数据层的介质；</p>
<p>Reduce的作用是接收action并更新Store中对应的数据；</p>
</blockquote>
<p>总结（个人理解）：</p>
<ol>
<li>用户在UI组件中触发了相应的action，这就到了ActionCreator；</li>
<li>而后通过dispatch方法，触发action到store，store将action给了reducers；</li>
<li>reducers监听到action，根据条件返回更新之后的state给store，更新了store中的数据；</li>
<li>store中的数据更新后，UI页面随之同步更新</li>
</ol>
<p>2、使用Event Bus(事件总线)来解决</p>
<h3 id="9、高阶组件"><a href="#9、高阶组件" class="headerlink" title="9、高阶组件"></a>9、高阶组件</h3><blockquote>
<p>高阶组件（HOC (Highter-Order- Components) ）是react中对组件逻辑进行重用的高级技术。但高阶组件本身并不是React API。它只是一种模式，这种模式是由react自身的组合性质必然产生的。</p>
</blockquote>
<p><strong>具体而言，高阶组件就是一个函数（也可以说是一个组件），且该函数接受一个组件作为参数，并返回一个新的组件，也可以重写部分生命周期</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EnhancedComponent = higherOrderComponent(WrappedComponent);</span><br></pre></td></tr></table></figure>

<p>对比组件将props属性转变成UI，高阶组件则是将一个组件转换成另一个新组件。<br>高阶组件在React第三方库中很常见，比如Redux的connect方法和Relay的createContainer.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//该组件代理了Component，只是多传递了一个name参数</span></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">Component</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">name</span>=<span class="string">&quot;高阶组件&quot;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="高阶链式调用"><a href="#高阶链式调用" class="headerlink" title="高阶链式调用"></a><strong>高阶链式调用</strong></h4><blockquote>
<p>高阶组件最巧妙的一点，是可以链式调用</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">Component</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">name</span>=<span class="string">&quot;zujian&quot;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent = <span class="function"><span class="params">Component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">NewComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">      	<span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;didMount&#x27;</span>, <span class="built_in">this</span>.props)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>hello,&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo(MyComponent(App))</span><br></pre></td></tr></table></figure>

<h4 id="高阶组件装饰器写法"><a href="#高阶组件装饰器写法" class="headerlink" title="高阶组件装饰器写法"></a><strong>高阶组件装饰器写法</strong></h4><blockquote>
<p>这种链式写法逻辑比较绕，ES7中有一个优秀的语法—-装饰器， 专门用来处理这种问题</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save--dev babel-plugin-transform-decorators-legacy</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; injectBabelPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;react-app-rewired&#x27;</span>)</span><br><span class="line"><span class="built_in">module</span>.export = <span class="function"><span class="keyword">function</span> <span class="title">override</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config = injectBabelPlugin(</span><br><span class="line">  	[<span class="string">&#x27;import&#x27;</span>,&#123;<span class="attr">libraryName</span>: <span class="string">&#x27;antd&#x27;</span>, <span class="attr">libraryDirectory</span>: <span class="string">&#x27;es&#x27;</span>, <span class="attr">style</span>: <span class="string">&#x27;css&#x27;</span>&#125;],</span><br><span class="line">    config,</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">  config = injectBabelPlugin(</span><br><span class="line">  	[<span class="string">&#x27;@babel/plugin-proposal-decorators&#x27;</span>, &#123;<span class="string">&quot;legacy&quot;</span>: <span class="literal">true</span>&#125;],</span><br><span class="line">    config,</span><br><span class="line">  )</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;Button&#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo = <span class="function">(<span class="params">Component</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">name</span>=<span class="string">&quot;zujian&quot;</span> /&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent = <span class="function"><span class="params">Component</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">NewComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">      	<span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...this.props</span>&#125; /&gt;</span></span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(Component.name, <span class="string">&#x27;didMount&#x27;</span>, <span class="built_in">this</span>.props)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Demo</span><br><span class="line">@MyComponent</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>hello,&#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span>&gt;</span>Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br></pre></td></tr></table></figure>

<h3 id="10、性能优化"><a href="#10、性能优化" class="headerlink" title="10、性能优化"></a>10、性能优化</h3><p>组件的性能优化基本集中在 <code>shouldComponentUpdate</code> 这个钩子函数上做文章。</p>
<blockquote>
<p>PS：下文中的 state 指代了 state 及 props</p>
</blockquote>
<p>​        在 <code>shouldComponentUpdate</code> 函数中我们可以通过返回布尔值来决定当前组件是否需要更新。</p>
<p>这层代码逻辑可以是简单地浅比较一下当前 <code>state</code> 和之前的 <code>state</code> 是否相同，也可以是判断某个值更</p>
<p>新了才触发组件更新。<strong>一般来说不推荐完整地对比当前 <code>state</code> 和之前的 <code>state</code> 是否相同，因</strong></p>
<p><strong>为组件更新触发可能会很频繁，这样的完整对比性能开销会有点大，可能会造成得不偿失的情况。</strong></p>
<p>​        当然如果真的想完整对比当前 <code>state</code> 和之前的 <code>state</code> 是否相同，并且不影响性能也是行得通的，</p>
<p>可以通过 immutable 或者 immer 这些库来生成不可变对象。这类库对于操作大规模的数据来说会提升</p>
<p>不错的性能，并且一旦改变数据就会生成一个新的对象，对比前后 <code>state</code> 是否一致也就方便多了，同时</p>
<p>也很推荐阅读下 immer 的源码实现。</p>
<p>另外<strong>如果只是单纯的浅比较一下，可以直接使用 <code>PureComponent</code>，底层就是实现了浅比较 <code>state</code>。</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React.PureComponent 与 React.Component 很相似。两者的区别在于 React.Component 并未实现 shouldComponentUpdate()，而 React.PureComponent 中以浅层对比 prop 和 state 的方式来实现了该函数。</span></span><br><span class="line"><span class="comment">//如果赋予 React 组件相同的 props 和 state，render() 函数会渲染相同的内容，那么在某些情况下使用 React.PureComponent 可提高性能。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        PureComponent</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//1、React.PureComponent 中的 shouldComponentUpdate() 仅作对象的浅层比较。如果对象中包含复杂的数据结构，则有可能因为无法检查深层的差别，产生错误的比对结果。仅在你的 props 和 state 较为简单时，才使用 React.PureComponent，或者在深层数据结构发生变化时调用 forceUpdate() 来确保组件被正确地更新。你也可以考虑使用 immutable 对象加速嵌套数据的比较。</span></span><br><span class="line"><span class="comment">//2、React.PureComponent 中的 shouldComponentUpdate() 将跳过所有子组件树的 prop 更新。因此，请确保所有子组件也都是“纯”的组件。</span></span><br></pre></td></tr></table></figure>

<p>这时候你可能会考虑到函数组件就不能使用这种方式了，如果你使用 16.6.0 之后的版本的话，可以使用 **<code>React.memo</code> **来实现相同的功能。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// React.mome为高阶组件。适用于函数组件，不适用于class组件</span></span><br><span class="line"><span class="comment">//如果你的函数组件在给定相同 props 的情况下渲染相同的结果，那么你可以通过将其包装在 React.memo 中调用，以此通过记忆组件渲染结果的方式来提高组件的性能表现。</span></span><br><span class="line"><span class="keyword">const</span> MyComponent = React.memo(<span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//使用props渲染</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//或</span></span><br><span class="line"><span class="keyword">const</span> Test = React.memo(<span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        PureComponent</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 默认情况下其只会对复杂对象做浅层对比，如果你想要控制对比过程，那么请将自定义的比较函数通过第二个参数传入来实现。</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* 使用 props 渲染 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">areEqual</span>(<span class="params">prevProps, nextProps</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  如果把 nextProps 传入 render 方法的返回结果与</span></span><br><span class="line"><span class="comment">  将 prevProps 传入 render 方法的返回结果一致则返回 true，</span></span><br><span class="line"><span class="comment">  否则返回 false</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> React.memo(MyComponent, areEqual);</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：</span></span><br><span class="line"><span class="comment">//1、此方法仅作为性能优化的方式而存在。但请不要依赖它来“阻止”渲染，因为这会产生 bug。</span></span><br><span class="line"><span class="comment">//2、与 class 组件中 shouldComponentUpdate() 方法不同的是，如果 props 相等，areEqual 会返回 true；如果 props 不相等，则返回 false。这与 shouldComponentUpdate 方法的返回值相反。</span></span><br></pre></td></tr></table></figure>

<p>通过这种方式我们就可以既实现了 <code>shouldComponentUpdate</code> 的浅比较，又能够使用函数组件。</p>
<h3 id="11、事件机制"><a href="#11、事件机制" class="headerlink" title="11、事件机制"></a>11、事件机制</h3><p>推荐文章地址：<a target="_blank" rel="noopener" href="https://qianduan.group/posts/5cb1b0e49fd64d5a7458a981">https://qianduan.group/posts/5cb1b0e49fd64d5a7458a981</a></p>
<p>React 自己实现了一套事件机制，首先我们考虑一下以下代码：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Test = <span class="function">(<span class="params">&#123; list, handleClick &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">    list.map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;index&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">    ))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>​        以上类似代码想必大家经常会写到，但是你是否考虑过点击事件是否绑定在了每一个标签上？事实当然不是，JSX 上写的事件并没有绑定在对应的真实 DOM 上，而是通过<strong>事件代理</strong>的方式，将所有的事件都统一绑定在了 <code>document</code> 上。这样的方式不仅减少了内存消耗，还能在组件挂载销毁时统一订阅和移除事件。</p>
<p>​        另外冒泡到 <code>document</code> 上的事件也不是原生浏览器事件，而是 React 自己实现的<strong>合成事件（SyntheticEvent）</strong>。</p>
<p>​        <strong>因此我们如果不想要事件冒泡的话，调用 <code>event.stopPropagation</code> 是无效的，而应该调用 <code>event.preventDefault</code>。</strong></p>
<p>那么实现合成事件的目的是什么呢？优点有两点，分别是：</p>
<ul>
<li>合成事件首先抹平了浏览器之间的兼容问题，另外这是一个跨浏览器原生事件包装器，赋予了跨浏览器开发的能力</li>
<li>对于原生浏览器事件来说，浏览器会给监听器创建一个事件对象。如果你有很多的事件监听，那么就需要分配很多的事件对象，造成高额的内存分配问题。但是对于合成事件来说，有一个事件池专门来管理它们的创建和销毁，当事件需要被使用时，就会从池子中复用对象，事件回调结束后，就会销毁事件对象上的属性，从而便于下次复用事件对象。</li>
</ul>
<p>React事件处理将接受SyntheticEvent实例，它封装了浏览器原生事件对象，并对浏览器做了兼容。他和浏览器原生事件对象有相同的接口，包括stopPropagation()和preventDefault()。如果出于某些原因想使用浏览器原生事件，可以使用 <code>nativeEvent</code> 属性获取。每个SyntheticEvent对象都有下面的属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">boolean bubbles</span><br><span class="line">boolean cancelable</span><br><span class="line">DOMEventTarget currentTarget</span><br><span class="line">boolean defaultPrevented</span><br><span class="line">number eventPhase</span><br><span class="line">boolean isTrusted</span><br><span class="line">DOMEvent nativeEvent</span><br><span class="line"><span class="keyword">void</span> preventDefault()</span><br><span class="line">boolean isDefaultPrevented()</span><br><span class="line"><span class="keyword">void</span> stopPropagation()</span><br><span class="line">boolean isPropagationStopped()</span><br><span class="line">DOMEventTarget target</span><br><span class="line">number timeStamp</span><br><span class="line">string type</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个组件有什么问题。为什么？要如何解决呢？</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">state = &#123; <span class="attr">search</span>: <span class="string">&#x27;&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">handleChange = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这是“防抖”函数的简单实现，它会以队列的方式在 250 ms 内调用</span></span><br><span class="line"><span class="comment">     * 表达式并取消所有挂起的队列表达式。以这种方式我们可以在用户停止输</span></span><br><span class="line"><span class="comment">     * 入时延迟 250 ms 来调用表达式。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="built_in">this</span>.timeout);</span><br><span class="line">    <span class="built_in">this</span>.timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.setState(&#123;</span><br><span class="line">        <span class="attr">search</span>: event.target.value</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">250</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.state.search ? <span class="tag">&lt;<span class="name">p</span>&gt;</span>Search for: &#123;this.state.search&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span> : null&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在防抖函数中并没有错误。那么应用会按期望方式运行吗？它会在用户停止输入的 250 ms 之后更新并且渲染字符串“Search for: …”吗？</span></span><br><span class="line"><span class="comment">// 这里的问题是在 React 中 event 是一个 SyntheticEvent，如果和它的交互被延迟了（例如：通过 setTimeout），事件会被清除并且 .target.value 引用不会再有效。</span></span><br></pre></td></tr></table></figure>

<p><strong>合成事件是池化的，也就是说<code>SyntheticEvent</code>对象会被重用，而且当事件回调函数被执行后所有的属性将被销毁。这也是出于性能的考虑。因此你不能异步访问<code>event</code>。</strong>如：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 再来看下面这个例子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(props);</span><br><span class="line">        <span class="built_in">this</span>.handleClick=<span class="built_in">this</span>.handleClick.bind(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">handleClick</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// e.persist();</span></span><br><span class="line">        <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">// 在这里使用事件对象e的时候，控制台会报错</span></span><br><span class="line">            <span class="built_in">console</span>.log(e);</span><br><span class="line">            <span class="built_in">console</span>.log(e.type);</span><br><span class="line">        &#125;,<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">HelloWorld</span>/&gt;</span></span>,<span class="built_in">document</span>.body);</span><br></pre></td></tr></table></figure>

<p><img src="./9.png" alt="9"></p>
<p>当一个事件响应函数执行过后，事件的属性被设置为 null， 如果想用保持事件的值的话，可以调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">event.persist()</span><br></pre></td></tr></table></figure>

<p>这样，属性会被保留，并且事件也会被从池中取出。</p>
<h3 id="12、React未来"><a href="#12、React未来" class="headerlink" title="12、React未来"></a>12、React未来</h3><h4 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a><strong>Fiber</strong></h4><p>是什么？</p>
<p>​    Fiber是React16中新的协调引擎。</p>
<p>为什么要使用？或者说有什么用？</p>
<p>​    主要的目的是使虚拟DOM可以进行<strong>增量式渲染</strong>。目标是提高其对动画，布局和手势等区域的适用性。</p>
<blockquote>
<p>​    增量式渲染：将渲染工作分成多个块并将其分布到多个帧中的能力。</p>
</blockquote>
<p>推荐文章地址：<a target="_blank" rel="noopener" href="https://juejin.im/post/5dadc6045188255a270a0f85#heading-13">https://juejin.im/post/5dadc6045188255a270a0f85#heading-13</a></p>
<p>举例：</p>
<p>在之前的版本中，如果你拥有一个很复杂的复合组件，然后改动了最上层组件的 <code>state</code>，那么调用栈可能会很长</p>
<p><img src="./2019-06-01-043727.png" alt="2019-06-01-043727"></p>
<p>调用栈过长，再加上中间进行了复杂的操作，就可能导致长时间阻塞主线程，带来不好的用户体验。Fiber 就是为了解决该问题而生。</p>
<p>Fiber 本质上是一个虚拟的堆栈帧，新的调度器会按照优先级自由调度这些帧，从而将之前的同步渲染改成了异步渲染，在不影响体验的情况下去分段计算更新。</p>
<p>同步渲染 vs 异步渲染</p>
<p>React的新引擎Fiber的关键特性如下：</p>
<ul>
<li><p>增量渲染（把渲染任务拆分成块，匀到多帧）</p>
</li>
<li><p>更新时能够暂停，终止，复用渲染任务</p>
</li>
<li><p>给不同类型的更新赋予优先级</p>
</li>
<li><p>并发方面新的基础能力</p>
</li>
</ul>
<h4 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a><strong>Suspense</strong></h4><blockquote>
<p>用同步的代码来实现异步操作</p>
</blockquote>
<p>以下为常见的异步操作代码：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        callAPI().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.setState(&#123;<span class="attr">data</span>: result&#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">this</span>.state.data) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>this.state.data<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1、组件必须要有自己的state和componentDidMount函数实现，也就不可能做成纯函数形式的组件。</p>
<p>2、需要两次渲染过程，第一次是mount引发的渲染，由componentDidMount触发ajax然后修改state，然后第二次渲染才真的渲染出内容</p>
<p>3、代码比较繁琐</p>
<p>拥抱Suspense</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Foo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = createFetcher(callAJAX).read();</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：createFetcher还没有正式发布</p>
<p><code>React.Suspense</code> 可以指定加载指示器（loading indicator），以防其组件树中的某些子组件尚未具备渲染条件。目前，懒加载组件是 <code>&lt;React.Suspense&gt;</code> 支持的<strong>唯一</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Suspense&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;unstable_createResource <span class="keyword">as</span> createResource&#125; <span class="keyword">from</span> <span class="string">&#x27;react-cache&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getName = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> resource = createResource(getName);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gteeting = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;resource.read()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SuspenseDemo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">div</span>&gt;</span>loading...<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Gteeting</span> /&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>变革：函数组件可以做数据的获取，扩展了FP在react中的应用</p>
<h4 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a><strong>Hooks</strong></h4><blockquote>
<p>Hook是React16.8的新增特性。它可以让你在不编写class的情况下使用state以及其他的React特性</p>
</blockquote>
<p>推荐文章地址：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/75146261">https://zhuanlan.zhihu.com/p/75146261</a></p>
<p><strong>useState</strong></p>
<p>Hooks的目的，是开发者可以完全抛弃class，拥抱函数式提供一个叫usestate的方法，它开启了一扇新的定义state的门，对应counter的代码可以这么写：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Counter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        	<span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count - 1)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以设置多个</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [foo, updateFoo] = useState(<span class="string">&#x27;foo&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>useEffect</strong></p>
<p>除了<code>useState</code>，React还提供了<code>useEffect</code>，用于支持组件中增加副作用的支持。对应class写法中的生命周期</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`hi,<span class="subst">$&#123;<span class="built_in">this</span>.state.count&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="title">componentDidUpdate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">document</span>.title = <span class="string">`hi,<span class="subst">$&#123;<span class="built_in">this</span>.state.count&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Counter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    useEffect(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">document</span>.title = <span class="string">`hi,<span class="subst">$&#123;count&#125;</span>`</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">    	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        	<span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count + 1)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setCount(count - 1)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>useEffect的参数是一个函数，组件每次渲染之后，都会调用这个函数参数，这样就达到了componentDidMount和componentDidUpdate一样的效果</p>
<p>Hooks会大大减少react的代码</p>
<h2 id="四、React路由"><a href="#四、React路由" class="headerlink" title="四、React路由"></a>四、React路由</h2><p>React路由文档：<a target="_blank" rel="noopener" href="http://react-guide.github.io/react-router-cn/">http://react-guide.github.io/react-router-cn/</a></p>
<blockquote>
<p><code>HashRouter</code> 用于指定当前项目中使用哪一种路由模式</p>
<p><code>Route</code> 用于配置路由规则,同时当做路由占位符</p>
<p><code>Link</code> 用于设置路由跳转链接，使用to属性指定跳转路径</p>
<hr>
<p>注意:</p>
<ol>
<li><code>HashRouter</code>用于指定路由模式,在项目中只使用一次,而且其内部只能有一个根元素</li>
<li><code>Route</code>用于配置路由规则,同时也是路由占位符</li>
<li><code>exact</code>属性可以设置路由规则被精确匹配</li>
</ol>
</blockquote>
<h3 id="1、基本使用"><a href="#1、基本使用" class="headerlink" title="1、基本使用"></a>1、基本使用</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 安装react-router-dom</span></span><br><span class="line">yarn add react-router-dom</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 在项目根组件中导入路由组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&#x27;@/components/Hello.jsx&#x27;</span></span><br><span class="line"><span class="keyword">import</span> CommentList <span class="keyword">from</span> <span class="string">&#x27;@/components/CommentList.jsx&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用Route创建路由规则</span></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        	<span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/home&#x27;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/list&#x27;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">            </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/home&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/list&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、路由传参"><a href="#2、路由传参" class="headerlink" title="2、路由传参"></a>2、路由传参</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方式一:params传参</span></span><br><span class="line"><span class="comment">// 1. 设置跳转路径(12345是实参)</span></span><br><span class="line">&lt;Link to=<span class="string">&#x27;/list/12345&#x27;</span>&gt;列表&lt;/Link&gt; </span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">this</span>.props.hitory.push(<span class="string">&#x27;/list/12345&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 设置路由规则(:id是形参)</span></span><br><span class="line">&lt;Route path=<span class="string">&#x27;/list/:id/:type/:tag&#x27;</span> component=&#123;List&#125;&gt;&lt;/Route&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 3. 在路由对应的组件中获取参数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.props.match.params.id) <span class="comment">// 12345</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式二:query传参</span></span><br><span class="line"><span class="comment">// 特点:不需在再路由规则中添加形参;在地址栏中看不到传递的参数</span></span><br><span class="line"><span class="comment">// 1. 设置跳转路径</span></span><br><span class="line">&lt;Link to=&#123;&#123;<span class="attr">pathname</span>:<span class="string">&#x27;/list&#x27;</span>,<span class="attr">query</span>:&#123;<span class="attr">id</span>:<span class="number">12345</span>,<span class="attr">type</span>:<span class="string">&#x27;movie&#x27;</span>&#125;&#125;&#125;&gt;列表&lt;/Link&gt; </span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">this</span>.props.hitory.push(&#123;<span class="attr">pathname</span>:<span class="string">&#x27;/list&#x27;</span>,<span class="attr">query</span>:&#123;<span class="attr">id</span>:<span class="number">12345</span>,<span class="attr">type</span>:<span class="string">&#x27;movie&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 设置路由规则</span></span><br><span class="line">&lt;Route path=<span class="string">&#x27;/list&#x27;</span> component=&#123;List&#125;&gt;&lt;/Route&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 3. 在路由对应的组件中获取参数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.props.location.query.type) <span class="comment">// movie</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式三:state传参</span></span><br><span class="line"><span class="comment">// 特点:不需要在路由规则中添加形参;在地址栏中看不到传递的参数；可以将参数缓存,刷新页面参数也会存在</span></span><br><span class="line"><span class="comment">// 1. 设置跳转路径</span></span><br><span class="line">&lt;Link to=&#123;&#123;<span class="attr">pathname</span>:<span class="string">&#x27;/list&#x27;</span>,<span class="attr">state</span>:&#123;<span class="attr">id</span>:<span class="number">12345</span>,<span class="attr">type</span>:<span class="string">&#x27;movie&#x27;</span>&#125;&#125;&#125;&gt;列表&lt;/Link&gt; </span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">this</span>.props.hitory.push(&#123;<span class="attr">pathname</span>:<span class="string">&#x27;/list&#x27;</span>,<span class="attr">state</span>:&#123;<span class="attr">id</span>:<span class="number">12345</span>,<span class="attr">type</span>:<span class="string">&#x27;movie&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 设置路由规则</span></span><br><span class="line">&lt;Route path=<span class="string">&#x27;/list&#x27;</span> component=&#123;List&#125;&gt;&lt;/Route&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 3. 在路由对应的组件中获取参数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.props.location.state.type) <span class="comment">// movie</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式四:search传参</span></span><br><span class="line">&lt;Link to=&#123;&#123;<span class="attr">pathname</span>:<span class="string">&#x27;/list?id=12345&amp;type=movie&#x27;</span>&#125;&#125;&gt;列表&lt;/Link&gt; </span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="built_in">this</span>.props.hitory.push(&#123;<span class="attr">pathname</span>:<span class="string">&#x27;/list?id=12345&amp;type=movie&#x27;</span>)</span><br><span class="line">                        </span><br><span class="line"><span class="comment">// 2. 设置路由规则</span></span><br><span class="line">&lt;Route path=<span class="string">&#x27;/list&#x27;</span> component=&#123;List&#125;&gt;&lt;/Route&gt;</span><br><span class="line">                       </span><br><span class="line"><span class="comment">// 3. 在路由对应的组件中获取参数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">this</span>.props.location.search) <span class="comment">// ?id=12345&amp;type=movie</span></span><br><span class="line"><span class="comment">// id=12345&amp;type=movie</span></span><br><span class="line"><span class="comment">// [id=12345,type=movie]</span></span><br><span class="line"><span class="comment">// &#123;id:12345,type:&#x27;movie&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3、路由重定向"><a href="#3、路由重定向" class="headerlink" title="3、路由重定向"></a>3、路由重定向</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入路由重定向组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link, Redirect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 使用Route组件上的render函数实现重定向</span></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        	<span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/home&#x27;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&#x27;/list&#x27;</span>&gt;</span>列表<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="xml">            </span></span><br><span class="line"><span class="xml">            &#123;/* from: 你想由哪个路径进行重定向，包括动态段。 to: 你想重定向的路径 */&#125;</span></span><br><span class="line"><span class="xml">          	&#123;/* 访问根路径 / 时 会跳转到 /home*/&#125;  </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/&#x27;</span> <span class="attr">render</span>=<span class="string">&#123;()</span> =&gt;</span> <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">&#x27;/home&#x27;</span>/&gt;</span>&#125; exact&gt;<span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;/* exact为精准匹配 */&#125; </span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/home&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> <span class="attr">exact</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/list&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;List&#125;</span> <span class="attr">exact</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span>  </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、路由嵌套"><a href="#4、路由嵌套" class="headerlink" title="4、路由嵌套"></a>4、路由嵌套</h3><blockquote>
<p>React路由嵌套实现的是每个组件中都可以定义路由规则</p>
<p>A组件对应的路由是 ‘/home’ <code>&lt;Route path=&#39;/home&#39; component=&#123;A&#125;&gt;&lt;/Route&gt;</code></p>
<p>A组件内部如果又定义了路由规则  <code>&lt;Route path=&#39;/newslist&#39; component=&#123;B&#125;&gt;&lt;/Route&gt;</code></p>
<p>路由规则 <code>/newslist</code> 是<code>/home</code>的子路由,同时B组件也是A组件的子组件。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路由嵌套示例：</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Switch, Redirect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 引入展示组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; About, Contact, Home, Products, Events, NotFound404, Details &#125; <span class="keyword">from</span> <span class="string">&#x27;./pages&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/about&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/contact&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Contact&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/products&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Products&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/events&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Events&#125;/</span>&gt;</span>  </span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&#x27;/history&#x27;</span> <span class="attr">to</span>=<span class="string">&#x27;about/history&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">Redirect</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/details/:type&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Details&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span>     </span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;NotFound404&#125;/</span>&gt;</span>     </span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span>     </span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br><span class="line"></span><br><span class="line"><span class="comment">//About</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> About = <span class="function">() =&gt;</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">className</span>=<span class="string">&quot;about&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">AboutMenu</span>&gt;</span><span class="tag">&lt;/<span class="name">AboutMenu</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/about&#x27;</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Company&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/about/history&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;History&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/about/services&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Services&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/about/location&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Location&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//AboutMenu</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> AboutMenu = <span class="function">() =&gt;</span> (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">className</span>=<span class="string">&quot;about-menu&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#x27;/about&#x27;</span> <span class="attr">exact</span> <span class="attr">activeStyle</span> =<span class="string">&#123;selectedStyle&#125;</span>&gt;</span>公司简介<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#x27;/about/history&#x27;</span> <span class="attr">activeStyle</span> =<span class="string">&#123;selectedStyle&#125;</span>&gt;</span>公司历史<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#x27;/about/services&#x27;</span> <span class="attr">activeStyle</span> =<span class="string">&#123;selectedStyle&#125;</span>&gt;</span>公司服务<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">NavLink</span> <span class="attr">to</span>=<span class="string">&#x27;/about/location&#x27;</span> <span class="attr">activeStyle</span> =<span class="string">&#123;selectedStyle&#125;</span>&gt;</span>公司位置<span class="tag">&lt;/<span class="name">NavLink</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="五、Redux"><a href="#五、Redux" class="headerlink" title="五、Redux"></a>五、Redux</h2><p>官方文档：<a target="_blank" rel="noopener" href="https://www.redux.org.cn/">https://www.redux.org.cn/</a></p>
<p>Redux 是 JavaScript 状态容器，提供可预测化的状态管理。类似于vue中的vuex。</p>
<p>这里有一篇较好的博客示例讲解：<a target="_blank" rel="noopener" href="https://github.com/brickspert/blog/issues/22">https://github.com/brickspert/blog/issues/22</a></p>
<p><img src="./redux_.png" alt="redux_"></p>
<p>action就是动作，也就是通过动作来修改state的值。也是修改store的唯一途径。</p>
<p>Store表示的是整个的数据存储中心，集中大部分页面需要的状态以及数据；</p>
<p>ActionCreators表示的是view 视图层与data数据层的介质；</p>
<p>Reduce的作用是接收action并更新Store中对应的数据；</p>
<p>总结（个人理解）：</p>
<p>​    1、用户在UI组件中触发了相应的action，这就到了ActionCreator；</p>
<p>​    2、而后通过dispatch方法，触发action到store，store将action给了reducers；</p>
<p>​    3、reducers监听到action，根据条件返回更新之后的state给store，更新了store中的数据；</p>
<p>​    4、store中的数据更新后，UI页面随之同步更新</p>
<h3 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h3><p><strong>三大原则</strong></p>
<p><strong>1、单一数据源</strong></p>
<p>​    使用redux的程序，所有的state都存储在一个单一的数据源store内部，类似一个巨大的对象树。</p>
<p><strong>2、state是只读的</strong></p>
<p>​    state是只读的，能改变state的唯一方式是通过触发action来修改</p>
<p><strong>3、使用纯函数执行修改</strong></p>
<p>​    为了描述 action 如何改变 state tree ， 你需要编写 reducers。</p>
<p>​    reducers是一些纯函数，接口当前state和action。只需要根据action，返回对应的state。而且必须要有返回。</p>
<p>​    </p>
<p>纯函数概念：</p>
<p>​    一个函数的返回结果只依赖于它的参数，并且在执行过程里面没有副作用，我们就把这个函数叫做纯函数</p>
<p><strong>基本概念及介绍</strong></p>
<p><strong>1、action</strong><br>顾名思义，action就是动作，也就是通过动作来修改state的值。也是修改store的唯一途径。</p>
<p>action本质上就是一个普通js对象，我们约定这个对象必须有一个字段type，来表示我们的动作名称。一般我们会使用一个常量来表示type对应的值。</p>
<p>此外，我们还会把希望state变成什么样子的对应的值通过action传进来，那么这里action可能会类似这样子的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span> <span class="comment">//导入存放自定义的常量，以避免不必要的错误发生</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.HANDLE_CHANGE,</span><br><span class="line">    data,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>2、Reducer</strong><br>Action 只是描述了有事情发生了这件事实，但并没有说明要做哪些改变，这正是reducer需要做的事情。</p>
<p>Reducer作为纯函数，内部不建议使用任何有副作用的操作，比如操作外部的变量，任何导致相同输入但输出却不一致的操作。</p>
<p>如果我们的reducer比较多，比较复杂，我们不能把所有的逻辑都放到一个reducer里面去处理，这个时候我们就需要拆分reducer。</p>
<p>幸好，redux提供了一个api就是combineReducers Api。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">抽离的组件中的reducer.js文件</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span> <span class="comment">//导入存放自定义的常量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState = &#123;  <span class="comment">//定义的初始默认数据</span></span><br><span class="line">    <span class="attr">focused</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">totaPage</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">mouse</span>: <span class="literal">false</span>,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = defaultState, action) =&gt; &#123; <span class="comment">//监听action，更新store</span></span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_FOCUS:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;focused&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_BLUR:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;focused&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">case</span> constants.CHANGE_LIST:</span><br><span class="line">            <span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">                <span class="attr">list</span>: action.data,</span><br><span class="line">                <span class="attr">totaPage</span>: action.totaPage</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_ENTER:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;mouse&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_LEAVE:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;mouse&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">case</span> constants.HANDLE_CHANGE:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;page&#x27;</span>, action.data)</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">在根组件的reducer.js文件中需要使用combineReducers方法整合reducer</span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-immutable&#x27;</span>;  </span><br><span class="line"><span class="keyword">import</span> &#123; reducer <span class="keyword">as</span> headerReducer &#125; <span class="keyword">from</span> <span class="string">&#x27;../common/header/store&#x27;</span> <span class="comment">//导入抽离的组件中的reducer文件；通过as可以更改名字</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = combineReducers (&#123; <span class="comment">//整合reducer</span></span><br><span class="line">    <span class="attr">header</span>: headerReducer</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br><span class="line"></span><br><span class="line">具体结构见下图：</span><br></pre></td></tr></table></figure>

<p><img src="./2019-07-05_154421.png" alt="2019-07-05_154421"></p>
<p><strong>3、store</strong><br>store是redux应用的唯一数据源，我们调用createStore Api创建store。</p>
<h3 id="2、基本安装及使用示例"><a href="#2、基本安装及使用示例" class="headerlink" title="2、基本安装及使用示例"></a>2、基本安装及使用示例</h3><p><strong>1、安装依赖</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install redux --save</span><br></pre></td></tr></table></figure>

<p><strong>2、创建store（index.js文件）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore, compose, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span>;	<span class="comment">//导入redux</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;./reducer.js&#x27;</span> <span class="comment">//导入reducer文件</span></span><br><span class="line"><span class="keyword">import</span> thunk <span class="keyword">from</span> <span class="string">&#x27;redux-thunk&#x27;</span> <span class="comment">//导入中间件thunk</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;</span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, composeEnhancers(</span><br><span class="line">    applyMiddleware(thunk)</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure>

<p><strong>3、创建reducer（reducer.js文件）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState = &#123;</span><br><span class="line">    <span class="attr">focused</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">list</span>: [],</span><br><span class="line">    <span class="attr">page</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">totaPage</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">mouse</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (state = defaultState, action) =&gt; &#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_FOCUS:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;focused&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_BLUR:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;focused&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">case</span> constants.CHANGE_LIST:</span><br><span class="line">            <span class="keyword">return</span> state.merge(&#123;</span><br><span class="line">                <span class="attr">list</span>: action.data,</span><br><span class="line">                <span class="attr">totaPage</span>: action.totaPage</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_ENTER:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;mouse&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">case</span> constants.SEARCH_LEAVE:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;mouse&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">case</span> constants.HANDLE_CHANGE:</span><br><span class="line">            <span class="keyword">return</span> state.set(<span class="string">&#x27;page&#x27;</span>, action.data)</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>4、创建action（actionCreators.js文件）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> constants <span class="keyword">from</span> <span class="string">&#x27;./constants&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeList = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.CHANGE_LIST,</span><br><span class="line">    data,</span><br><span class="line">    <span class="attr">totaPage</span>: <span class="built_in">Math</span>.ceil(data.length / <span class="number">10</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchFocus = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.SEARCH_FOCUS</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchBlur = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.SEARCH_BLUR</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchEnter = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.SEARCH_ENTER</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> searchLeave = <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.SEARCH_LEAVE</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">data</span>) =&gt;</span> (&#123;</span><br><span class="line">    <span class="attr">type</span>: constants.HANDLE_CHANGE,</span><br><span class="line">    data,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getList = <span class="function">() =&gt;</span> &#123; <span class="comment">//使用redux-thunk的时候，可以在action中发送异步请求</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">&#x27;/api/headerList.json&#x27;</span>).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> data = res.data;</span><br><span class="line">            dispatch(changeList(data.data))</span><br><span class="line">        &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;error&quot;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>5、抽离常量，创建action-type（这里定义的当然是自定义的，看你自己怎么写）</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_FOCUS = <span class="string">&#x27;header/SEARCH_FOCUS&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_BLUR = <span class="string">&#x27;header/SEARCH_BLUR&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_ENTER = <span class="string">&#x27;header/SEARCH_ENTER&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SEARCH_LEAVE = <span class="string">&#x27;header/SEARCH_LEAVE&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CHANGE_LIST = <span class="string">&#x27;header/CHANGE_LIST&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> HANDLE_CHANGE = <span class="string">&#x27;header/HANDLE_CHANGE&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="3、中间件"><a href="#3、中间件" class="headerlink" title="3、中间件"></a>3、中间件</h3><p><strong>1、redux的中间件是什么</strong></p>
<p>redux中间件的中间指的是action和store之间</p>
<p><img src="./redux.png" alt="redux"></p>
<p><strong>2、redux的中间件有什么用</strong></p>
<p>​    redux的中间件就是一个对dispatch方法的升级（封装），以前的dispatch只能接收一个对象，升级（封装）之后可以传递对象和函数</p>
<p><strong>3、redux-saga中间件的使用</strong></p>
<blockquote>
<ul>
<li>创建store的时候根据redux-sagas官方文档的配置把redux-sagas的配置好</li>
<li>引入createSagaMiddleware然后去创建一个sagaMiddleware</li>
<li>然后通过applyMiddleware去使用这个中间件</li>
<li>接着创建一个saga.js文件，然后在store的index文件里引入这个文件</li>
<li>再通过sagaMiddleware去运行引入的这个文件</li>
<li>书写saga.js文件，saga.js文件中一定要导出generator函数。</li>
</ul>
</blockquote>
<p>注意：在generator函数（ES6新增）里面做异步请求的时候就不要再使用promise的形式了。用yield来做。</p>
<p>简单示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//代码步骤</span></span><br><span class="line"><span class="comment">//1、下载依赖包：yarn add redux-saga  or  npm install --save redux-saga</span></span><br><span class="line"><span class="comment">//2、在创建store的文件中（通常为index.js），引入一个方法</span></span><br><span class="line">	<span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">&#x27;redux-saga&#x27;</span> <span class="comment">//引入创建saga中间件的方法</span></span><br><span class="line">	<span class="keyword">const</span> sagaMiddleware = createSagaMiddleware(); <span class="comment">//创建saga中间件</span></span><br><span class="line"><span class="comment">//3、在组件中，发起action</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware, compose &#125; <span class="keyword">from</span> <span class="string">&#x27;redux&#x27;</span></span><br><span class="line"><span class="keyword">import</span> reducer <span class="keyword">from</span> <span class="string">&#x27;./reducer&#x27;</span></span><br><span class="line"><span class="keyword">import</span> createSagaMiddleware <span class="keyword">from</span> <span class="string">&#x27;redux-saga&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Mysaga <span class="keyword">from</span> <span class="string">&#x27;./saga&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sagaMiddleware = createSagaMiddleware()</span><br><span class="line"><span class="keyword">const</span> composeEnhancers = <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose</span><br><span class="line"><span class="keyword">const</span> enhancer = composeEnhancers(applyMiddleware(sagaMiddleware))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(reducer, enhancer);</span><br><span class="line"></span><br><span class="line">sagaMiddleware.run(Mysaga)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例saga.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; takeEvery, put &#125; <span class="keyword">from</span> <span class="string">&#x27;redux-saga/effects&#x27;</span> <span class="comment">//更多api详见官网</span></span><br><span class="line"><span class="keyword">import</span> &#123; GET_INIT_LIST &#125; form <span class="string">&#x27;./actionTypes&#x27;</span>  <span class="comment">//这个文件是自己的，用于专门存放 &#x27;定义常量&#x27;</span></span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span> <span class="comment">// 引入异步请求库axios</span></span><br><span class="line"><span class="keyword">import</span> &#123; initListAction &#125; <span class="keyword">from</span> <span class="string">&#x27;./actionCreators&#x27;</span> <span class="comment">//引入专门存放action的文件中当前请求需要使用的action</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ES6中的generator函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">mySaga</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//监听GET_INIT_LIST这个对应的action，如果监听到了，则触发fetchUser这个方法，这个方法可以是普通函数，也可以是generator函数</span></span><br><span class="line">  <span class="keyword">yield</span> takeEvery(GET_INIT_LIST, fetchUser); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*function* fetchUser() &#123;</span></span><br><span class="line"><span class="comment">  const res = yield axios.get(&#x27;/list.json&#x27;); //yield类似于等待的意思</span></span><br><span class="line"><span class="comment">  const action = initListAction(res.data);</span></span><br><span class="line"><span class="comment">  yield put(action);</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  //注意:在generator函数中，不要写这种promise的写法了</span></span><br><span class="line"><span class="comment">  //axios.get(&#x27;/list.json&#x27;).then((res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">    //const data = res.data;</span></span><br><span class="line"><span class="comment">    //const action = initListAction(data);</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    //在saga中是不行的</span></span><br><span class="line"><span class="comment">    //store.dispatch(action);</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    //put(action);</span></span><br><span class="line"><span class="comment">  //&#125;)</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">fetchUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;  <span class="comment">//try catch语法，可以防止ajax请求没有返回数据，或者出了其他的错误的时候，就会执行catch语句</span></span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">yield</span> axios.get(<span class="string">&#x27;/list.json&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> action = initListAction(res.data);</span><br><span class="line">    <span class="keyword">yield</span> put(action);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    cosnole.log(<span class="string">&#x27;error&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意：记得一定要导出这个generator函数</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> mySaga</span><br></pre></td></tr></table></figure>



<p><strong>4、redux-thunk和redux-saga的区别</strong></p>
<p>相同点：</p>
<p>​    都是可以处理异步操作和协调复杂的dispatch。</p>
<p>不同点：</p>
<p>1、redux-saga 是通过 Generator 函数来创建的，即用同步的方式写异步的代码</p>
<p>2、redux-thunk 是在 action 被创建时才调用；redux-saga 在应用启动时就开始调用，监听action 并做相应处理； （通过创建 saga.js文件将所有的异步操作逻辑收集在一个地方集中处理）</p>
<p>3、启动的任务可以在任何时候通过手动取消，也可以把任务和其他的 Effects 放到 race 方法里可以自动取消</p>
<p>redux-saga提供了很多API，更方便适合处理大型项目；redux-thunk中API则很少，一般适合用于中小型项目</p>
<p>saga文档链接：</p>
<p><a target="_blank" rel="noopener" href="https://redux-saga-in-chinese.js.org/docs/advanced/NonBlockingCalls.html">https://redux-saga-in-chinese.js.org/docs/advanced/NonBlockingCalls.html</a></p>
<h2 id="六、规范"><a href="#六、规范" class="headerlink" title="六、规范"></a>六、规范</h2><p>类名遵循小驼峰命名法；</p>
<p>样式类名命名最好有语义，尽量遵循BEM（BlockElementModifier）；</p>
<p>尽量不要使用<code>!important</code>；</p>
<p>在使用 CSS 预处理器书写样式时，样式嵌套最好不要超过三层；</p>
<p>尽量给项目中的变量添加默认值<code>defaultProps</code>；</p>
<p>与后台进行交互时，数据最好进行校验；</p>
<p>有不需要使用双闭合标签的地方，可以使用单标签闭合方式；</p>
<p>在多个地方都需要使用的代码，可以考虑抽离，做成公共组件使用；</p>
<p>为防止格式问题，最好在提交代码前将其文件进行代码格式化，可以考虑引入ESLint；</p>
<h2 id="七、小实验"><a href="#七、小实验" class="headerlink" title="七、小实验"></a>七、小实验</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这几个向组件传递函数的方式，你能解释它们的不同吗？</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 当你点击每个按钮会发生什么？</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.name = <span class="string">&#x27;MyComponent&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.handleClick2 = <span class="built_in">this</span>.handleClick1.bind(<span class="built_in">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">handleClick1</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    alert(<span class="built_in">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleClick3 = <span class="function">() =&gt;</span> alert(<span class="built_in">this</span>.name);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick1()&#125;</span>&gt;</span>click 1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick1&#125;</span>&gt;</span>click 2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick2&#125;</span>&gt;</span>click 3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick3&#125;</span>&gt;</span>click 4<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 这道题要稍微费点功夫，因为代码比较多。如果候选人回答正确紧接着问“为什么？”。为什么 click 2 这会以这种方式运行？</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 这个不是 React 问题，如果有人的回答以“因为在 React 中……”开始，这说明他们没有真正理解 JS 事件循环机制。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这个例子有什么问题，要如何修改或改进这个组件？</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">props</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(props);</span><br><span class="line">    <span class="built_in">this</span>.state = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="built_in">this</span>.props.name || <span class="string">&#x27;Anonymous&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello &#123;this.state.name&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有很多方式来解决它：移除 state 并使用 props，实现 getDerivedStateFromProps 或者更好的方式是把该组件变为函数组件。</span></span><br></pre></td></tr></table></figure>

<p>小试题：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/80366959">https://zhuanlan.zhihu.com/p/80366959</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Arvin Huang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://hello-hc.github.io/2019/11/08/new-react-file/new-react-file/">https://hello-hc.github.io/2019/11/08/new-react-file/new-react-file/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://hello-hc.github.io" target="_blank">Arvin's Blogs</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/images/aixin.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/01/03/taro-study/"><img class="prev-cover" src="/images/img_03.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Taro Study</div></div></a></div><div class="next-post pull-right"><a href="/2019/09/30/ES%E9%81%8D%E5%8E%86%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F%E6%96%B9%E6%B3%95/"><img class="next-cover" src="/images/tianqi.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ES5及以后的几种遍历方法</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Arvin Huang</div><div class="author-info__description">仅作为本人学习使用</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hello-hc"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hello-hc" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/2867712953@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#React"><span class="toc-number">1.</span> <span class="toc-text">React</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%89%8D%E6%8F%90%E5%9F%BA%E7%A1%80"><span class="toc-number">1.1.</span> <span class="toc-text">一、前提基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81JavaScript%E5%9F%BA%E7%A1%80%EF%BC%88ECMAScript%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">1、JavaScript基础（ECMAScript）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81let%E3%80%81const"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1、let、const</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81import%E3%80%81export"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">2、import、export</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81class%E3%80%81extends%E3%80%81super"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">3、class、extends、super</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.1.4.</span> <span class="toc-text">4、箭头函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.1.1.5.</span> <span class="toc-text">5、模板字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC"><span class="toc-number">1.1.1.6.</span> <span class="toc-text">6、解构赋值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81default%E5%87%BD%E6%95%B0%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"><span class="toc-number">1.1.1.7.</span> <span class="toc-text">7、default函数默认参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81rest-arguments-%EF%BC%88rest%E5%8F%82%E6%95%B0%EF%BC%89"><span class="toc-number">1.1.1.8.</span> <span class="toc-text">8、rest arguments （rest参数）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E5%B1%95%E5%BC%80%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.1.1.9.</span> <span class="toc-text">9、展开运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E3%80%81%E5%AF%B9%E8%B1%A1%E7%AE%80%E5%86%99"><span class="toc-number">1.1.1.10.</span> <span class="toc-text">10、对象简写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11%E3%80%81Generators"><span class="toc-number">1.1.1.11.</span> <span class="toc-text">11、Generators</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12%E3%80%81Promise"><span class="toc-number">1.1.1.12.</span> <span class="toc-text">12、Promise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13%E3%80%81async-await"><span class="toc-number">1.1.1.13.</span> <span class="toc-text">13、async await</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14%E3%80%81Set-%E5%92%8C-Map%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.1.14.</span> <span class="toc-text">14、Set 和 Map数据结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15%E3%80%81JS%E6%96%B0%E5%A2%9E%E9%81%8D%E5%8E%86%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.1.15.</span> <span class="toc-text">15、JS新增遍历方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#for-in"><span class="toc-number">1.1.1.15.1.</span> <span class="toc-text">for in</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#for-of"><span class="toc-number">1.1.1.15.2.</span> <span class="toc-text">for of</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#forEach"><span class="toc-number">1.1.1.15.3.</span> <span class="toc-text">forEach</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#map"><span class="toc-number">1.1.1.15.4.</span> <span class="toc-text">map</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#object-keys-values"><span class="toc-number">1.1.1.15.5.</span> <span class="toc-text">object.keys()&#x2F;values()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Array"><span class="toc-number">1.1.1.15.6.</span> <span class="toc-text">Array</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Node%E5%9F%BA%E7%A1%80"><span class="toc-number">1.1.2.</span> <span class="toc-text">2、Node基础</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81npm-amp-amp-npx-amp-amp-nvm"><span class="toc-number">1.1.3.</span> <span class="toc-text">3、npm &amp;&amp; npx &amp;&amp; nvm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#npm-node-package-manager-%EF%BC%9A"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">npm (node package manager)：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#npx%EF%BC%9A"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">npx：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nvm-node-version-manager-%EF%BC%9A"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">nvm (node version manager)：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81webpack%EF%BC%88%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97%E5%8C%96%E7%AE%A1%E7%90%86%E5%92%8C%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%EF%BC%89"><span class="toc-number">1.1.4.</span> <span class="toc-text">4、webpack（资源模块化管理和打包工具）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA"><span class="toc-number">1.2.</span> <span class="toc-text">二、项目搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BD%BF%E7%94%A8%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">1、使用脚手架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8webpack"><span class="toc-number">1.2.2.</span> <span class="toc-text">2、使用webpack</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEwebpack-config-js"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">配置webpack.config.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-babelrc"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">配置.babelrc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEnpm%E8%84%9A%E6%9C%AC"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">配置npm脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%EF%BC%9A"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">扩展：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">三、知识点梳理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81JSX"><span class="toc-number">1.3.1.</span> <span class="toc-text">1、JSX</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1、介绍示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E5%9C%A8React%E4%B8%AD%E5%BF%85%E9%A1%BB%E5%A3%B0%E6%98%8E%E5%BC%95%E5%85%A5React"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2、在React中必须声明引入React</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E3%80%81%E7%82%B9%E8%A1%A8%E7%A4%BA%E8%AF%AD%E6%B3%95"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">3、点表示语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%E3%80%81%E9%A6%96%E5%AD%97%E6%AF%8D%E5%A4%A7%E5%86%99"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">4、首字母大写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%E3%80%81%E8%BF%90%E8%A1%8C%E6%97%B6%E9%80%89%E6%8B%A9%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">5、运行时选择类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%E3%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.1.6.</span> <span class="toc-text">6、属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%E3%80%81%E9%BB%98%E8%AE%A4%E5%80%BC%E4%B8%BAtrue"><span class="toc-number">1.3.1.7.</span> <span class="toc-text">7、默认值为true</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%E3%80%81%E6%89%A9%E5%B1%95%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.1.8.</span> <span class="toc-text">8、扩展属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%E3%80%81%E5%AD%90%E4%BB%A3"><span class="toc-number">1.3.1.9.</span> <span class="toc-text">9、子代</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%99%9A%E6%8B%9FDOM-%E5%92%8C-DIFF%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.2.</span> <span class="toc-text">2、虚拟DOM 和 DIFF算法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9FDOM"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">虚拟DOM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Diff%E7%AE%97%E6%B3%95"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">Diff算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81state-amp-amp-props"><span class="toc-number">1.3.3.</span> <span class="toc-text">3、state &amp;&amp; props</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#setState-%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">setState()数据更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#props"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">props</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">1.3.4.</span> <span class="toc-text">4、生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">属性校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A7%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">旧版生命周期函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#React16%E6%96%B0%E7%89%88%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">React16新版生命周期函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81key%E7%9A%84%E5%BF%85%E8%A6%81%E6%80%A7"><span class="toc-number">1.3.5.</span> <span class="toc-text">5、key的必要性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%AE%B9%E5%99%A8%E7%BB%84%E4%BB%B6-%E5%92%8C-%E5%B1%95%E7%A4%BA%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.6.</span> <span class="toc-text">6、容器组件 和 展示组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E6%9C%89%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6-%E5%92%8C-%E6%97%A0%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.7.</span> <span class="toc-text">7、有状态组件 和 无状态组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.7.1.</span> <span class="toc-text">无状态组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%89%E7%8A%B6%E6%80%81%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.7.2.</span> <span class="toc-text">有状态组件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.8.</span> <span class="toc-text">8、组件通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.8.1.</span> <span class="toc-text">父子组件通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%84%E5%BC%9F%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC"><span class="toc-number">1.3.8.2.</span> <span class="toc-text">兄弟组件传值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E5%A4%9A%E5%B1%82%E7%BA%A7%E7%BB%84%E4%BB%B6%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.8.3.</span> <span class="toc-text">跨多层级组件通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E7%BB%84%E4%BB%B6%E4%B9%8B%E9%97%B4%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="toc-number">1.3.8.4.</span> <span class="toc-text">任意组件之间的通信</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.9.</span> <span class="toc-text">9、高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8"><span class="toc-number">1.3.9.1.</span> <span class="toc-text">高阶链式调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E8%A3%85%E9%A5%B0%E5%99%A8%E5%86%99%E6%B3%95"><span class="toc-number">1.3.9.2.</span> <span class="toc-text">高阶组件装饰器写法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.10.</span> <span class="toc-text">10、性能优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E4%BA%8B%E4%BB%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">1.3.11.</span> <span class="toc-text">11、事件机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81React%E6%9C%AA%E6%9D%A5"><span class="toc-number">1.3.12.</span> <span class="toc-text">12、React未来</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Fiber"><span class="toc-number">1.3.12.1.</span> <span class="toc-text">Fiber</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Suspense"><span class="toc-number">1.3.12.2.</span> <span class="toc-text">Suspense</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hooks"><span class="toc-number">1.3.12.3.</span> <span class="toc-text">Hooks</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81React%E8%B7%AF%E7%94%B1"><span class="toc-number">1.4.</span> <span class="toc-text">四、React路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">1、基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-number">1.4.2.</span> <span class="toc-text">2、路由传参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%B7%AF%E7%94%B1%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.4.3.</span> <span class="toc-text">3、路由重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E8%B7%AF%E7%94%B1%E5%B5%8C%E5%A5%97"><span class="toc-number">1.4.4.</span> <span class="toc-text">4、路由嵌套</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Redux"><span class="toc-number">1.5.</span> <span class="toc-text">五、Redux</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E4%BB%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">1、简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%9F%BA%E6%9C%AC%E5%AE%89%E8%A3%85%E5%8F%8A%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">2、基本安装及使用示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">1.5.3.</span> <span class="toc-text">3、中间件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E8%A7%84%E8%8C%83"><span class="toc-number">1.6.</span> <span class="toc-text">六、规范</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%B0%8F%E5%AE%9E%E9%AA%8C"><span class="toc-number">1.7.</span> <span class="toc-text">七、小实验</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/08/28/react-big-calendar/react-big-calendar/" title="ReactBigCalendar的简单使用"><img src="/images/7.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ReactBigCalendar的简单使用"/></a><div class="content"><a class="title" href="/2021/08/28/react-big-calendar/react-big-calendar/" title="ReactBigCalendar的简单使用">ReactBigCalendar的简单使用</a><time datetime="2021-08-28T06:27:55.658Z" title="发表于 2021-08-28 14:27:55">2021-08-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/04/React-Redux/" title="Redux"><img src="/images/8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redux"/></a><div class="content"><a class="title" href="/2021/07/04/React-Redux/" title="Redux">Redux</a><time datetime="2021-07-04T06:46:11.446Z" title="发表于 2021-07-04 14:46:11">2021-07-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/01/React-Router/" title="React-Router"><img src="/images/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="React-Router"/></a><div class="content"><a class="title" href="/2021/07/01/React-Router/" title="React-Router">React-Router</a><time datetime="2021-07-01T13:53:55.473Z" title="发表于 2021-07-01 21:53:55">2021-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/06/04/vite/vite/" title="Vite 初探"><img src="/images/img_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vite 初探"/></a><div class="content"><a class="title" href="/2021/06/04/vite/vite/" title="Vite 初探">Vite 初探</a><time datetime="2021-06-04T02:00:55.000Z" title="发表于 2021-06-04 10:00:55">2021-06-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/01/03/taro-study/" title="Taro Study"><img src="/images/img_03.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Taro Study"/></a><div class="content"><a class="title" href="/2021/01/03/taro-study/" title="Taro Study">Taro Study</a><time datetime="2021-01-03T12:20:08.883Z" title="发表于 2021-01-03 20:20:08">2021-01-03</time></div></div></div></div></div></div></main><footer id="footer" style="background: linear-gradient( 135deg,"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Arvin Huang</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>